<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我推 - My Favorite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 不使用CDN，使用简单的内联样式替代图标 -->
    <style>
        /* 简单的图标替代样式 */
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: #3B82F6;
            border-radius: 4px;
            position: relative;
        }
        .icon:before, .icon:after {
            content: '';
            position: absolute;
            background-color: white;
        }
        /* 简单的复选框替代 */
        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #3B82F6;
            border-radius: 4px;
            display: inline-block;
            position: relative;
            cursor: pointer;
        }
        .checkbox.checked:after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #3B82F6;
            font-weight: bold;
        }
    </style>
    <!-- 简单的Chart.js替代实现 -->
    <script>
        // 简单的图表替代类，模拟Chart.js的基本功能
        class SimpleChart {
            constructor(ctx, config) {
                this.ctx = ctx;
                this.config = config;
                this.canvas = ctx.canvas;
                this.render();
            }
            
            render() {
                const { width, height } = this.canvas;
                const data = this.config.data;
                
                // 清空画布
                this.ctx.clearRect(0, 0, width, height);
                
                // 绘制简单的条形图或折线图
                if (this.config.type === 'bar') {
                    this.renderBarChart();
                } else if (this.config.type === 'line') {
                    this.renderLineChart();
                } else {
                    // 默认绘制简单文本
                    this.ctx.fillStyle = '#333';
                    this.ctx.font = '16px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('图表数据可用', width/2, height/2);
                }
            }
            
            renderBarChart() {
                const { width, height } = this.canvas;
                const data = this.config.data;
                const barWidth = width / data.labels.length * 0.7;
                const maxValue = Math.max(...data.datasets[0].data);
                
                data.labels.forEach((label, index) => {
                    const value = data.datasets[0].data[index];
                    const barHeight = (value / maxValue) * (height - 40);
                    const x = index * (width / data.labels.length) + (width / data.labels.length - barWidth) / 2;
                    const y = height - 30 - barHeight;
                    
                    // 绘制柱状图
                    this.ctx.fillStyle = data.datasets[0].backgroundColor || '#3B82F6';
                    this.ctx.fillRect(x, y, barWidth, barHeight);
                    
                    // 绘制标签
                    this.ctx.fillStyle = '#333';
                    this.ctx.font = '12px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(label, x + barWidth/2, height - 10);
                });
            }
            
            renderLineChart() {
                const { width, height } = this.canvas;
                const data = this.config.data;
                const maxValue = Math.max(...data.datasets[0].data);
                
                // 绘制折线
                this.ctx.beginPath();
                data.datasets[0].data.forEach((value, index) => {
                    const x = (index / (data.datasets[0].data.length - 1)) * (width - 40) + 20;
                    const y = height - 30 - (value / maxValue) * (height - 40);
                    
                    if (index === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                });
                this.ctx.strokeStyle = data.datasets[0].borderColor || '#3B82F6';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // 绘制点
                data.datasets[0].data.forEach((value, index) => {
                    const x = (index / (data.datasets[0].data.length - 1)) * (width - 40) + 20;
                    const y = height - 30 - (value / maxValue) * (height - 40);
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    this.ctx.fillStyle = data.datasets[0].backgroundColor || '#3B82F6';
                    this.ctx.fill();
                    
                    // 绘制标签
                    if (data.labels && data.labels[index]) {
                        this.ctx.fillStyle = '#333';
                        this.ctx.font = '12px Arial';
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText(data.labels[index], x, height - 10);
                    }
                });
            }
        }
        
        // 确保Chart全局变量可用
        window.Chart = function(ctx, config) {
            return new SimpleChart(ctx, config);
        };
    </script>
    <script src="/static/mock_data.js"></script>
    <script>
        // Tailwind 配置
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        accent: '#60A5FA',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .sidebar-shadow {
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.07);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .hover-scale {
                transition: transform 0.2s ease;
            }
            .hover-scale:hover {
                transform: scale(1.02);
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen flex flex-col transition-all duration-300">
    <!-- 顶部导航栏 -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 shadow-sm transition-all duration-300">
        <div class="container mx-auto px-4 flex items-center justify-between h-16">
            <div class="flex items-center space-x-2">
                <i class="fa fa-weibo text-xl text-red-500"></i>
                <h1 class="text-xl font-bold text-primary dark:text-secondary">我推 - My Favorite</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fa fa-moon-o dark:hidden"></i>
                    <i class="fa fa-sun-o hidden dark:block"></i>
                </button>
                <div class="relative">
                    <span id="status-indicator" class="inline-block w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-full"></span>
                    <span id="status-text" class="ml-2 text-sm">未运行</span>
                </div>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <div class="flex pt-16 min-h-screen">
        <!-- 左侧导航栏 -->
        <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-white dark:bg-gray-800 sidebar-shadow overflow-y-auto scrollbar-hide transition-all duration-300 transform z-40">
            <nav class="py-6 px-4">
                <ul class="space-y-1">
                    <li>
                        <a href="#dashboard" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg bg-primary/10 text-primary dark:bg-primary/20 dark:text-secondary font-medium">
                            <i class="fa fa-dashboard text-lg"></i>
                            <span>仪表盘</span>
                        </a>
                    </li>
                    <li>
                        <a href="#config" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-cog text-lg"></i>
                            <span>配置管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="#tasks" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-tasks text-lg"></i>
                            <span>任务执行</span>
                        </a>
                    </li>
                    <li>
                        <a href="#results" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-folder-open text-lg"></i>
                            <span>结果管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="#logs" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-file-text text-lg"></i>
                            <span>日志查看</span>
                        </a>
                    </li>
                    <li>
                        <a href="#about" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-info-circle text-lg"></i>
                            <span>关于</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- 右侧内容区 -->
        <main class="flex-1 ml-64 transition-all duration-300 p-6">
            <!-- 仪表盘区域 -->
            <section id="dashboard" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">仪表盘</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-blue-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">已爬取用户</p>
                                    <h3 class="text-2xl font-bold mt-1" id="user-count">0</h3>
                                </div>
                                <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-full">
                                    <i class="fa fa-users text-blue-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-green-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">已爬取微博</p>
                                    <h3 class="text-2xl font-bold mt-1" id="weibo-count">0</h3>
                                </div>
                                <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-full">
                                    <i class="fa fa-comment text-green-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-purple-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">已下载文件</p>
                                    <h3 class="text-2xl font-bold mt-1" id="file-count">0</h3>
                                </div>
                                <div class="p-3 bg-purple-100 dark:bg-purple-900/50 rounded-full">
                                    <i class="fa fa-download text-purple-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-orange-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">任务成功率</p>
                                    <h3 class="text-2xl font-bold mt-1" id="success-rate">0%</h3>
                                </div>
                                <div class="p-3 bg-orange-100 dark:bg-orange-900/50 rounded-full">
                                    <i class="fa fa-line-chart text-orange-500"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">爬取趋势</h3>
                            <div class="h-64">
                                <canvas id="crawl-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">最近爬取的用户</h3>
                            <div class="overflow-y-auto h-64 scrollbar-hide">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <th class="text-left py-2 text-sm font-medium">用户</th>
                                            <th class="text-left py-2 text-sm font-medium">微博数</th>
                                            <th class="text-left py-2 text-sm font-medium">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-users">
                                        <tr>
                                            <td colspan="3" class="text-center py-8 text-gray-500 dark:text-gray-400">暂无数据</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 配置管理区域 -->
            <section id="config" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">配置管理</h2>
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">基本配置</h3>
                            <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                                <i class="fa fa-save mr-2"></i>保存配置
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">用户ID列表</label>
                                <textarea id="user-id-list" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="3" placeholder="请输入用户ID，多个ID用逗号分隔或换行"></textarea>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">也可以输入user_id_list.txt文件路径</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">搜索关键词列表</label>
                                <textarea id="query-list" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="3" placeholder="请输入搜索关键词，多个关键词用逗号分隔或换行"></textarea>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">设置后将按关键词搜索微博</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">爬取模式</label>
                                <select id="only-crawl-original" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                                    <option value="0">爬取全部微博</option>
                                    <option value="1">仅爬取原创微博</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">起始日期</label>
                                <div class="flex space-x-2">
                                    <input type="number" id="since-date-days" class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="天数">
                                    <span class="flex items-center text-gray-500">天前</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">文件存储（可多选）</label>
                                <div class="grid grid-cols-2 gap-2 mb-4">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="write-csv" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>CSV</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="write-json" class="rounded text-primary focus:ring-primary/50">
                                        <span>JSON</span>
                                    </label>
                                </div>
                                
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">数据库存储（单选）</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="database" id="db-sqlite" class="rounded-full text-primary focus:ring-primary/50" checked>
                                        <span>SQLite</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="database" id="db-mysql" class="rounded-full text-primary focus:ring-primary/50">
                                        <span>MySQL</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="database" id="db-mongodb" class="rounded-full text-primary focus:ring-primary/50">
                                        <span>MongoDB</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">下载选项</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">图片下载</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="original-pic" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>原创微博图片</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="retweet-pic" class="rounded text-primary focus:ring-primary/50">
                                        <span>转发微博图片</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">视频下载</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="original-video" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>原创微博视频</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="retweet-video" class="rounded text-primary focus:ring-primary/50">
                                        <span>转发微博视频</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">评论与转发</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="download-comment" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>下载评论</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="download-repost" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>下载转发</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">高级配置</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cookie</label>
                                <textarea id="cookie" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="2" placeholder="your cookie"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">其他选项</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="remove-html-tag" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>移除HTML标签</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="user-id-as-folder" class="rounded text-primary focus:ring-primary/50">
                                        <span>使用用户ID作为文件夹名</span>
                                    </label>
                                </div>
                            </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">MySQL配置 <span class="text-xs text-gray-500 dark:text-gray-400">(可选)</span></h3>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="enable-mysql" class="rounded text-primary focus:ring-primary/50">
                                <span>启用MySQL</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">主机</label>
                                <input type="text" id="mysql-host" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="localhost">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">端口</label>
                                <input type="number" id="mysql-port" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="3306" value="3306">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">用户名</label>
                                <input type="text" id="mysql-user" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="root">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">密码</label>
                                <input type="password" id="mysql-password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="password">
                            </div>
                            <div class="md:col-span-2 lg:col-span-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">字符集</label>
                                <input type="text" id="mysql-charset" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="utf8mb4" value="utf8mb4">
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">MongoDB配置 <span class="text-xs text-gray-500 dark:text-gray-400">(可选)</span></h3>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="enable-mongodb" class="rounded text-primary focus:ring-primary/50">
                                <span>启用MongoDB</span>
                            </label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">MongoDB URI</label>
                            <input type="text" id="mongodb-uri" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]">
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">定期自动爬取设置 <span class="text-xs text-gray-500 dark:text-gray-400">(可选)</span></h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">自动爬取频率</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="hourly" class="text-primary focus:ring-primary/50">
                                        <span>每小时</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="daily" class="text-primary focus:ring-primary/50">
                                        <span>每天</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="weekly" class="text-primary focus:ring-primary/50">
                                        <span>每周</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="custom" class="text-primary focus:ring-primary/50">
                                        <span>自定义</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">自定义间隔（分钟）</label>
                                <input type="number" id="custom-interval" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="60" value="60">
                                <label class="flex items-center space-x-2 mt-4">
                                    <input type="checkbox" id="enable-schedule" class="rounded text-primary focus:ring-primary/50">
                                    <span>启用定期自动爬取</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 任务执行区域 -->
            <section id="tasks" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">任务执行</h2>
                    <div class="mb-6">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="start-task" class="px-6 py-3 bg-success text-white rounded-lg hover:bg-success/90 transition-colors flex-1 flex items-center justify-center">
                                <i class="fa fa-play mr-2"></i>开始爬取
                            </button>
                            <button id="stop-task" class="px-6 py-3 bg-danger text-white rounded-lg hover:bg-danger/90 transition-colors flex-1 flex items-center justify-center" disabled>
                                <i class="fa fa-stop mr-2"></i>停止爬取
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">任务进度</h3>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2">
                            <div id="progress-bar" class="bg-primary h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400">
                            <span id="progress-text">0%</span>
                            <span id="progress-status">准备就绪</span>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">任务日志</h3>
                        <div id="task-log" class="w-full h-64 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 overflow-y-auto text-sm font-mono"></div>
                    </div>
                </div>
            </section>

            <!-- 结果管理区域 -->
            <section id="results" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">结果管理</h2>
                    <div class="flex justify-between items-center mb-4">
                        <div class="relative">
                            <input type="text" id="search-results" class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="搜索结果...">
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="refresh-results" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <i class="fa fa-refresh mr-2"></i>刷新
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th class="text-left py-3 px-4 font-semibold">用户</th>
                                    <th class="text-left py-3 px-4 font-semibold">微博数</th>
                                    <th class="text-left py-3 px-4 font-semibold">文件数</th>
                                    <th class="text-left py-3 px-4 font-semibold">最后更新</th>
                                    <th class="text-left py-3 px-4 font-semibold">操作</th>
                                </tr>
                            </thead>
                            <tbody id="results-table">
                                <tr>
                                    <td colspan="5" class="text-center py-8 text-gray-500 dark:text-gray-400">暂无数据</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 日志查看区域 -->
            <section id="logs" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">日志查看</h2>
                    <div class="flex justify-between items-center mb-4">
                        <select id="log-level" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                            <option value="all">全部</option>
                            <option value="info">信息</option>
                            <option value="warning">警告</option>
                            <option value="error">错误</option>
                        </select>
                        <button id="clear-logs" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <i class="fa fa-trash mr-2"></i>清空
                        </button>
                    </div>
                    <div id="logs-content" class="w-full h-96 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 overflow-y-auto text-sm font-mono"></div>
                </div>
            </section>

            <!-- 关于区域 -->
            <section id="about" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">关于</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">我推 - My Favorite</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">这是一个功能强大的微博爬虫可视化工具，可以帮助您轻松爬取微博用户数据。</p>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                                <li><i class="fa fa-check text-success mr-2"></i>支持多用户同时爬取</li>
                                <li><i class="fa fa-check text-success mr-2"></i>支持多种数据格式导出</li>
                                <li><i class="fa fa-check text-success mr-2"></i>支持图片、视频下载</li>
                                <li><i class="fa fa-check text-success mr-2"></i>支持评论、转发爬取</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">使用说明</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-600 dark:text-gray-300">
                                <li>在配置管理中设置爬取参数</li>
                                <li>点击保存配置按钮</li>
                                <li>在任务执行中点击开始爬取</li>
                                <li>查看爬取进度和日志</li>
                                <li>在结果管理中查看和下载爬取结果</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 文件预览模态框 -->
    <div id="file-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold" id="modal-title">文件预览</h3>
                <button id="close-modal" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-4 overflow-y-auto max-h-[calc(90vh-100px)]" id="modal-content">
                <!-- 模态框内容将在这里动态生成 -->
            </div>
        </div>
    </div>

    <script>
        // 初始化主题
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // 主题切换
        document.getElementById('theme-toggle').addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        });

        // 导航链接高亮
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                // 移除所有高亮
                document.querySelectorAll('.nav-link').forEach(el => {
                    el.classList.remove('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-secondary', 'font-medium');
                    el.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                });
                // 添加当前高亮
                this.classList.add('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-secondary', 'font-medium');
                this.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                
                // 平滑滚动到对应区域
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // 初始化爬取趋势图表（添加错误处理）
        if (typeof Chart !== 'undefined') {
            try {
                const ctx = document.getElementById('crawl-chart').getContext('2d');
                const crawlChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                        datasets: [{
                            label: '爬取微博数',
                            data: [120, 190, 300, 500, 270, 430, 360],
                            borderColor: '#1E40AF',
                            backgroundColor: 'rgba(30, 64, 175, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.warn('图表初始化失败:', e);
            }
        } else {
            console.warn('Chart.js未加载，跳过图表初始化');
        }

        // 模拟数据
        function loadMockData() {
            // 仪表盘数据
            document.getElementById('user-count').textContent = '42';
            document.getElementById('weibo-count').textContent = '1,256';
            document.getElementById('file-count').textContent = '58';
            document.getElementById('success-rate').textContent = '98%';
            
            // 最近爬取用户
            const recentUsersHtml = `
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center mr-2"><i class="fa fa-user text-blue-500"></i></div> 迪丽热巴</div></td>
                    <td class="py-3 px-4">128</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 rounded-full text-xs">成功</span></td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center mr-2"><i class="fa fa-user text-pink-500"></i></div> 郭碧婷</div></td>
                    <td class="py-3 px-4">85</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 rounded-full text-xs">成功</span></td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center mr-2"><i class="fa fa-user text-purple-500"></i></div> 杨幂</div></td>
                    <td class="py-3 px-4">156</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 rounded-full text-xs">成功</span></td>
                </tr>
            `;
            document.getElementById('recent-users').innerHTML = recentUsersHtml;
            
            // 结果表格数据
            const resultsHtml = `
                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center mr-3"><i class="fa fa-user text-blue-500"></i></div> 迪丽热巴</div></td>
                    <td class="py-3 px-4">1,245</td>
                    <td class="py-3 px-4">36</td>
                    <td class="py-3 px-4">2023-08-21 15:30</td>
                    <td class="py-3 px-4">
                        <button class="view-btn px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm mr-2" data-user="迪丽热巴">查看</button>
                        <button class="download-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                    </td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center mr-3"><i class="fa fa-user text-pink-500"></i></div> 郭碧婷</div></td>
                    <td class="py-3 px-4">876</td>
                    <td class="py-3 px-4">24</td>
                    <td class="py-3 px-4">2023-08-21 14:15</td>
                    <td class="py-3 px-4">
                        <button class="view-btn px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm mr-2" data-user="郭碧婷">查看</button>
                        <button class="download-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                    </td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center mr-3"><i class="fa fa-user text-purple-500"></i></div> 杨幂</div></td>
                    <td class="py-3 px-4">2,345</td>
                    <td class="py-3 px-4">56</td>
                    <td class="py-3 px-4">2023-08-21 12:45</td>
                    <td class="py-3 px-4">
                        <button class="view-btn px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm mr-2" data-user="杨幂">查看</button>
                        <button class="download-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                    </td>
                </tr>
            `;
            document.getElementById('results-table').innerHTML = resultsHtml;
            
            // 加载配置数据
            document.getElementById('user-id-list').value = '1669879400, 1729370543, 1266321885';
            document.getElementById('since-date-days').value = '7';
            
            // 加载数据库配置
            document.getElementById('mysql-host').value = 'localhost';
            document.getElementById('mysql-port').value = '3306';
            document.getElementById('mysql-user').value = 'root';
            document.getElementById('mysql-password').value = '123456';
            document.getElementById('mysql-charset').value = 'utf8mb4';
            document.getElementById('mongodb-uri').value = 'mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]';
            
            // 添加查看按钮事件
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const user = this.getAttribute('data-user');
                    showFileModal(user);
                });
            });
        }

        // 显示文件预览模态框
        function showFileModal(user) {
            const modal = document.getElementById('file-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `${user} 的文件列表`;
            
            // 模拟文件列表
            const filesHtml = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-file-text text-blue-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">${user}_data.csv</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">2.5 MB · CSV文件</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">预览</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-file-text text-red-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">${user}_data.json</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">3.8 MB · JSON文件</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">预览</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-folder text-yellow-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">images/</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">36 个文件</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">查看</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-folder text-green-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">videos/</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">12 个文件</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">查看</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">下载</button>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = filesHtml;
            modal.classList.remove('hidden');
        }

        // 关闭模态框
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('file-modal').classList.add('hidden');
        });

        // 点击模态框外部关闭
        document.getElementById('file-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('file-modal')) {
                document.getElementById('file-modal').classList.add('hidden');
            }
        });

        // 数据库单选按钮事件处理
        document.querySelectorAll('input[name="database"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // 根据选择的数据库类型更新配置显示
                const mysqlConfig = document.querySelector('#enable-mysql').closest('.mb-8');
                const mongodbConfig = document.querySelector('#enable-mongodb').closest('.mb-8');
                
                if (this.id === 'db-mysql') {
                    mysqlConfig.style.display = 'block';
                    mongodbConfig.style.display = 'none';
                    document.getElementById('enable-mysql').checked = true;
                } else if (this.id === 'db-mongodb') {
                    mysqlConfig.style.display = 'none';
                    mongodbConfig.style.display = 'block';
                    document.getElementById('enable-mongodb').checked = true;
                } else {
                    mysqlConfig.style.display = 'none';
                    mongodbConfig.style.display = 'none';
                }
            });
        });

        // 页面加载时隐藏未选中的数据库配置
        document.addEventListener('DOMContentLoaded', function() {
            const mysqlConfig = document.querySelector('#enable-mysql').closest('.mb-8');
            const mongodbConfig = document.querySelector('#enable-mongodb').closest('.mb-8');
            
            // 默认只显示SQLite
            mysqlConfig.style.display = 'none';
            mongodbConfig.style.display = 'none';
        });

        // 保存配置到服务器
        async function saveConfigToServer(config) {
            try {
                // 验证必要的配置项
                if (!config) {
                    console.error('配置对象为空');
                    return { success: false, error: '配置对象为空' };
                }
                
                console.log('准备保存配置到服务器:', config);
                
                // 保存基础配置
                console.log('正在保存基础配置...');
                const baseResponse = await fetch('http://localhost:5000/config/base', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id_list: config.user_id_list,
                        query_list: config.query_list,
                        only_crawl_original: config.only_crawl_original,
                        since_date: config.since_date,
                        write_mode: config.write_mode,
                        original_pic_download: config.original_pic_download,
                        retweet_pic_download: config.retweet_pic_download,
                        original_video_download: config.original_video_download,
                        retweet_video_download: config.retweet_video_download,
                        cookie: config.cookie
                    })
                });
                
                const baseData = await baseResponse.json();
                console.log('基础配置保存响应:', baseResponse.status, baseData);
                
                if (!baseResponse.ok || !baseData.success) {
                    throw new Error(`保存基础配置失败: ${baseData.error || '未知错误'}`);
                }
                
                // 根据选择的数据库类型决定是否保存数据库配置
                const selectedDb = document.querySelector('input[name="database"]:checked');
                
                // 准备要发送的数据库配置
                const dbConfig = {};
                if (selectedDb) {
                    console.log(`正在保存${selectedDb.id === 'db-mysql' ? 'MySQL' : 'MongoDB'}数据库配置...`);
                    if (selectedDb.id === 'db-mysql' && config.mysql_config) {
                        dbConfig.mysql_config = config.mysql_config;
                    } else if (selectedDb.id === 'db-mongodb' && config.mongodb_URI) {
                        dbConfig.mongodb_URI = config.mongodb_URI;
                    }
                    
                    const response = await fetch('http://localhost:5000/config/database', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dbConfig)
                    });
                    
                    const dbData = await response.json();
                    console.log('数据库配置保存响应:', response.status, dbData);
                    
                    if (!response.ok || !dbData.success) {
                        throw new Error(`保存数据库配置失败: ${dbData.error || '未知错误'}`);
                    }
                } else {
                    console.log('未选择数据库，跳过数据库配置保存');
                }
                
                // 保存定期爬取配置
                console.log('正在保存定期爬取配置...');
                const scheduleResponse = await fetch('http://localhost:5000/config/schedule', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config.schedule_config || { enabled: false })
                });
                
                const scheduleData = await scheduleResponse.json();
                console.log('定期爬取配置保存响应:', scheduleResponse.status, scheduleData);
                
                if (!scheduleResponse.ok) {
                    throw new Error(`保存定时配置失败: ${scheduleData.error || '未知错误'}`);
                }
                
                console.log('所有配置保存成功');
                return { success: true, message: '配置保存成功' };
            } catch (error) {
                console.error('保存配置到服务器失败:', error);
                return { success: false, error: error.message || '保存失败' };
            }
        }
        
        // 保存配置
        document.getElementById('save-config').addEventListener('click', async () => {
            // 构建write_mode数组
            const write_mode = [];
            
            // 添加文件存储选项
            if (document.getElementById('write-csv')?.checked) write_mode.push('csv');
            if (document.getElementById('write-json')?.checked) write_mode.push('json');
            
            // 添加数据库选项（单选）
            const selectedDb = document.querySelector('input[name="database"]:checked');
            if (selectedDb) {
                if (selectedDb.id === 'db-sqlite') write_mode.push('sqlite');
                if (selectedDb.id === 'db-mysql') write_mode.push('mysql');
                if (selectedDb.id === 'db-mongodb') write_mode.push('mongodb');
            }
            
            // 保存配置
            const config = {
                user_id_list: document.getElementById('user-id-list')?.value || '',
                query_list: document.getElementById('query-list')?.value || '',
                only_crawl_original: document.getElementById('only-crawl-original')?.value || '',
                since_date: document.getElementById('since-date-days')?.value || '',
                write_mode: write_mode,
                original_pic_download: document.getElementById('original-pic')?.checked ? 1 : 0,
                retweet_pic_download: document.getElementById('retweet-pic')?.checked ? 1 : 0,
                original_video_download: document.getElementById('original-video')?.checked ? 1 : 0,
                retweet_video_download: document.getElementById('retweet-video')?.checked ? 1 : 0,
                download_comment: document.getElementById('download-comment')?.checked ? 1 : 0,
                download_repost: document.getElementById('download-repost')?.checked ? 1 : 0,
                remove_html_tag: document.getElementById('remove-html-tag')?.checked ? 1 : 0,
                user_id_as_folder_name: document.getElementById('user-id-as-folder')?.checked ? 1 : 0,
                cookie: document.getElementById('cookie')?.value || '',
                
                // MySQL配置
                mysql_config: {
                    host: document.getElementById('mysql-host')?.value || '',
                    port: document.getElementById('mysql-port') ? parseInt(document.getElementById('mysql-port').value) || 3306 : 3306,
                    user: document.getElementById('mysql-user')?.value || '',
                    password: document.getElementById('mysql-password')?.value || '',
                    charset: document.getElementById('mysql-charset')?.value || 'utf8mb4'
                },
                
                // MongoDB配置
                mongodb_URI: document.getElementById('mongodb-uri')?.value || '',
                
                // 定期爬取配置
                schedule_config: {
                    enabled: document.getElementById('enable-schedule')?.checked || false,
                    frequency: document.querySelector('input[name="schedule-frequency"]:checked')?.value || 'daily',
                    custom_interval: document.getElementById('custom-interval') ? parseInt(document.getElementById('custom-interval').value) || 60 : 60
                }
            };
            
            console.log('准备保存的配置:', config);
            
            // 保存配置到本地存储
            try {
                localStorage.setItem('weibo-crawler-config', JSON.stringify(config));
                console.log('配置已保存到本地存储');
            } catch (localStorageError) {
                console.error('保存配置到本地存储失败:', localStorageError);
            }
            
            // 保存配置到服务器
            const serverResult = await saveConfigToServer(config);
            
            if (serverResult.success) {
                alert('配置保存成功！所有设置已保存到服务器并会在重启后保留。');
            } else {
                alert(`配置保存失败！错误信息: ${serverResult.error || '未知错误'}\n配置已保存到本地，但服务器保存失败。`);
            }
        });
        
        // 从服务器加载配置
        async function loadConfigFromServer() {
            try {
                // 获取基础配置
                const baseResponse = await fetch('http://localhost:5000/config/base', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // 获取数据库配置
                const dbResponse = await fetch('http://localhost:5000/config/database', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // 获取定时任务配置
                const scheduleResponse = await fetch('http://localhost:5000/config/schedule', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (baseResponse.ok && dbResponse.ok && scheduleResponse.ok) {
                    const baseConfig = await baseResponse.json();
                    const dbConfig = await dbResponse.json();
                    const scheduleConfig = await scheduleResponse.json();
                    
                    return {
                        query_list: baseConfig.query_list,
                        cookie: baseConfig.cookie,
                        mysql_config: dbConfig.mysql_config,
                        mongodb_URI: dbConfig.mongodb_URI,
                        schedule_config: scheduleConfig
                    };
                }
                
                return null;
            } catch (error) {
                console.error('从服务器加载配置失败:', error);
                return null;
            }
        }
        
        // 加载保存的配置
        async function loadSavedConfig() {
            // 先尝试从服务器加载配置
            const serverConfig = await loadConfigFromServer();
            
            if (serverConfig) {
                // 设置MySQL配置
                if (serverConfig.mysql_config) {
                    if (serverConfig.mysql_config.host) document.getElementById('mysql-host').value = serverConfig.mysql_config.host;
                    if (serverConfig.mysql_config.port) document.getElementById('mysql-port').value = serverConfig.mysql_config.port;
                    if (serverConfig.mysql_config.user) document.getElementById('mysql-user').value = serverConfig.mysql_config.user;
                    if (serverConfig.mysql_config.password) document.getElementById('mysql-password').value = serverConfig.mysql_config.password;
                    if (serverConfig.mysql_config.charset) document.getElementById('mysql-charset').value = serverConfig.mysql_config.charset;
                }
                
                // 设置MongoDB配置
                if (serverConfig.mongodb_URI) document.getElementById('mongodb-uri').value = serverConfig.mongodb_URI;
                
                // 设置基础配置
                if (serverConfig.query_list) document.getElementById('query-list').value = serverConfig.query_list;
                if (serverConfig.cookie) document.getElementById('cookie').value = serverConfig.cookie;
                
                // 设置定期爬取配置
                if (serverConfig.schedule_config) {
                    if (serverConfig.schedule_config.enabled !== undefined) document.getElementById('enable-schedule').checked = serverConfig.schedule_config.enabled;
                    if (serverConfig.schedule_config.frequency) {
                        const freqInput = document.querySelector(`input[name="schedule-frequency"][value="${serverConfig.schedule_config.frequency}"]`);
                        if (freqInput) freqInput.checked = true;
                    }
                    if (serverConfig.schedule_config.custom_interval) document.getElementById('custom-interval').value = serverConfig.schedule_config.custom_interval;
                }
                
                console.log('已从服务器加载配置');
            } else {
                // 如果服务器加载失败，尝试从本地存储加载
                const savedConfig = localStorage.getItem('weibo-crawler-config');
                if (savedConfig) {
                    try {
                        const config = JSON.parse(savedConfig);
                        
                        // 设置基本配置
                        const userIdListElem = document.getElementById('user-id-list');
                        if (userIdListElem && config.user_id_list) userIdListElem.value = config.user_id_list;
                        
                        const queryListElem = document.getElementById('query-list');
                        if (queryListElem && config.query_list) queryListElem.value = config.query_list;
                        
                        const onlyCrawlOriginalElem = document.getElementById('only-crawl-original');
                        if (onlyCrawlOriginalElem && config.only_crawl_original !== undefined) onlyCrawlOriginalElem.value = config.only_crawl_original;
                        
                        const sinceDateElem = document.getElementById('since-date-days');
                        if (sinceDateElem && config.since_date) sinceDateElem.value = config.since_date;
                        
                        const cookieElem = document.getElementById('cookie');
                        if (cookieElem && config.cookie) cookieElem.value = config.cookie;
                        
                        // 设置写入模式
                        if (config.write_mode) {
                            const writeCsvElem = document.getElementById('write-csv');
                            if (writeCsvElem) writeCsvElem.checked = config.write_mode.includes('csv');
                            
                            const writeJsonElem = document.getElementById('write-json');
                            if (writeJsonElem) writeJsonElem.checked = config.write_mode.includes('json');
                            
                            const writeSqliteElem = document.getElementById('write-sqlite');
                            if (writeSqliteElem) writeSqliteElem.checked = config.write_mode.includes('sqlite');
                            
                            const writeMySqlElem = document.getElementById('write-mysql');
                            if (writeMySqlElem) writeMySqlElem.checked = config.write_mode.includes('mysql');
                        }
                        
                        // 设置下载选项
                        const originalPicElem = document.getElementById('original-pic');
                        if (originalPicElem && config.original_pic_download !== undefined) originalPicElem.checked = config.original_pic_download === 1;
                        
                        const retweetPicElem = document.getElementById('retweet-pic');
                        if (retweetPicElem && config.retweet_pic_download !== undefined) retweetPicElem.checked = config.retweet_pic_download === 1;
                        
                        const originalVideoElem = document.getElementById('original-video');
                        if (originalVideoElem && config.original_video_download !== undefined) originalVideoElem.checked = config.original_video_download === 1;
                        
                        const retweetVideoElem = document.getElementById('retweet-video');
                        if (retweetVideoElem && config.retweet_video_download !== undefined) retweetVideoElem.checked = config.retweet_video_download === 1;
                        
                        const downloadCommentElem = document.getElementById('download-comment');
                        if (downloadCommentElem && config.download_comment !== undefined) downloadCommentElem.checked = config.download_comment === 1;
                        
                        const downloadRepostElem = document.getElementById('download-repost');
                        if (downloadRepostElem && config.download_repost !== undefined) downloadRepostElem.checked = config.download_repost === 1;
                        
                        // 设置其他选项
                        const removeHtmlTagElem = document.getElementById('remove-html-tag');
                        if (removeHtmlTagElem && config.remove_html_tag !== undefined) removeHtmlTagElem.checked = config.remove_html_tag === 1;
                        
                        const userIdAsFolderElem = document.getElementById('user-id-as-folder');
                        if (userIdAsFolderElem && config.user_id_as_folder_name !== undefined) userIdAsFolderElem.checked = config.user_id_as_folder_name === 1;
                        
                        // 设置MySQL配置
                        if (config.mysql_config) {
                            const mysqlHostElem = document.getElementById('mysql-host');
                            if (mysqlHostElem && config.mysql_config.host) mysqlHostElem.value = config.mysql_config.host;
                            
                            const mysqlPortElem = document.getElementById('mysql-port');
                            if (mysqlPortElem && config.mysql_config.port) mysqlPortElem.value = config.mysql_config.port;
                            
                            const mysqlUserElem = document.getElementById('mysql-user');
                            if (mysqlUserElem && config.mysql_config.user) mysqlUserElem.value = config.mysql_config.user;
                            
                            const mysqlPasswordElem = document.getElementById('mysql-password');
                            if (mysqlPasswordElem && config.mysql_config.password) mysqlPasswordElem.value = config.mysql_config.password;
                            
                            const mysqlCharsetElem = document.getElementById('mysql-charset');
                            if (mysqlCharsetElem && config.mysql_config.charset) mysqlCharsetElem.value = config.mysql_config.charset;
                        }
                        
                        // 设置MongoDB配置
                        const mongodbUriElem = document.getElementById('mongodb-uri');
                        if (mongodbUriElem && config.mongodb_URI) mongodbUriElem.value = config.mongodb_URI;
                        
                        // 设置定期爬取配置
                        if (config.schedule_config) {
                            const enableScheduleElem = document.getElementById('enable-schedule');
                            if (enableScheduleElem && config.schedule_config.enabled !== undefined) enableScheduleElem.checked = config.schedule_config.enabled;
                            
                            if (config.schedule_config.frequency) {
                                try {
                                    const freqInput = document.querySelector(`input[name="schedule-frequency"][value="${config.schedule_config.frequency}"]`);
                                    if (freqInput) freqInput.checked = true;
                                } catch (err) {
                                    console.error('设置爬取频率时出错:', err);
                                }
                            }
                            
                            const customIntervalElem = document.getElementById('custom-interval');
                            if (customIntervalElem && config.schedule_config.custom_interval) customIntervalElem.value = config.schedule_config.custom_interval;
                        }
                        
                        console.log('已从本地存储加载配置');
                    } catch (e) {
                        console.error('加载保存的配置失败:', e);
                    }
                }
            }
        }
        
        // 初始化时加载保存的配置
        (async function() {
            await loadSavedConfig();
        })();

        // 开始爬取任务
        document.getElementById('start-task').addEventListener('click', async () => {
            const startBtn = document.getElementById('start-task');
            const stopBtn = document.getElementById('stop-task');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressStatus = document.getElementById('progress-status');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const taskLog = document.getElementById('task-log');
            
            // 更新按钮状态
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // 更新状态指示器
            statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full animate-pulse';
            statusText.textContent = '运行中';
            
            // 重置进度和日志
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            progressStatus.textContent = '开始爬取...';
            taskLog.innerHTML = '';
            
            // 添加开始日志
            addLog('[INFO] 开始爬取微博数据...', 'info');
            
            try {
                // 调用后端API开始任务
                const response = await fetch('http://localhost:5000/refresh', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                
                if (!response.ok) {
                    throw new Error(`API响应错误: ${response.status}`);
                }
                
                const data = await response.json();
                const taskId = data.task_id;
                addLog(`[INFO] 任务已创建，ID: ${taskId}`, 'info');
                
                // 轮询任务状态
                const checkStatus = async () => {
                    try {
                        // 添加超时的fetch请求
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5秒超时
                        
                        const statusResponse = await fetch(`http://localhost:5000/task/${taskId}`, {
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                        
                        if (!statusResponse.ok) {
                            throw new Error(`HTTP错误! 状态: ${statusResponse.status}`);
                        }
                        
                        const taskStatus = await statusResponse.json();
                        
                        // 更新进度
                        if (taskStatus.progress !== undefined) {
                            progressBar.style.width = `${taskStatus.progress}%`;
                            progressText.textContent = `${taskStatus.progress}%`;
                        }
                        
                        // 更新状态文本
                        if (taskStatus.state === 'PROGRESS') {
                            if (taskStatus.progress < 50) {
                                progressStatus.textContent = '正在爬取数据...';
                            } else {
                                progressStatus.textContent = '正在处理结果...';
                            }
                        } else if (taskStatus.state === 'SUCCESS') {
                            progressStatus.textContent = '任务完成';
                            progressBar.style.width = '100%';
                            progressText.textContent = '100%';
                            addLog('[INFO] 所有用户爬取完成', 'info');
                            addLog('[INFO] 任务执行成功', 'info');
                            
                            // 更新按钮状态
                            startBtn.disabled = false;
                            stopBtn.disabled = true;
                            statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full';
                            statusText.textContent = '已完成';
                            return;
                        } else if (taskStatus.state === 'FAILED') {
                            progressStatus.textContent = '任务失败';
                            addLog(`[ERROR] 任务执行失败: ${taskStatus.error}`, 'error');
                            
                            // 更新按钮状态
                            startBtn.disabled = false;
                            stopBtn.disabled = true;
                            statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                            statusText.textContent = '已失败';
                            return;
                        }
                        
                        // 继续轮询
                        setTimeout(checkStatus, 1000);
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            addLog('[ERROR] 获取任务状态超时，请检查服务是否正常运行', 'error');
                        } else {
                            addLog(`[ERROR] 获取任务状态失败: ${error.message}`, 'error');
                        }
                        startBtn.disabled = false;
                        stopBtn.disabled = true;
                        statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                        statusText.textContent = '已失败';
                    }
                };
                
                // 开始轮询
                setTimeout(checkStatus, 1000);
                
            } catch (error) {
                addLog(`[ERROR] 创建任务失败: ${error.message}`, 'error');
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                statusText.textContent = '已失败';
            }
        });
        
        // 添加日志辅助函数
        function addLog(message, level = 'info') {
            // 添加时间戳
            const now = new Date();
            const timestamp = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const logText = `[${timestamp}] ${message}`;
            
            const taskLog = document.getElementById('task-log');
            const logItem = document.createElement('div');
            logItem.textContent = logText;
            
            // 根据日志级别设置颜色
            if (level === 'info') {
                logItem.className = 'text-green-600 dark:text-green-400';
            } else if (level === 'warning') {
                logItem.className = 'text-yellow-600 dark:text-yellow-400';
            } else if (level === 'error') {
                logItem.className = 'text-red-600 dark:text-red-400';
            }
            
            taskLog.appendChild(logItem);
            taskLog.scrollTop = taskLog.scrollHeight;
            
            // 同时更新logs-content区域
            const logsContent = document.getElementById('logs-content');
            if (logsContent) {
                const logItemClone = logItem.cloneNode(true);
                logsContent.appendChild(logItemClone);
                logsContent.scrollTop = logsContent.scrollHeight;
            }
        }

        // 停止爬取任务
        document.getElementById('stop-task').addEventListener('click', async () => {
            const startBtn = document.getElementById('start-task');
            const stopBtn = document.getElementById('stop-task');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const progressStatus = document.getElementById('progress-status');
            
            // 更新按钮状态
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            try {
                // 调用后端API停止任务
                const response = await fetch('http://localhost:5000/task/cancel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    addLog('[INFO] 任务已成功停止', 'info');
                } else {
                    addLog('[WARNING] 停止任务时发生错误', 'warning');
                }
            } catch (error) {
                addLog(`[ERROR] 停止任务失败: ${error.message}`, 'error');
            }
            
            // 更新状态
            statusIndicator.className = 'inline-block w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-full';
            statusText.textContent = '已停止';
            progressStatus.textContent = '任务已停止';
            
            // 日志已通过addLog函数添加，无需重复添加
        });

        // 清空日志
        document.getElementById('clear-logs').addEventListener('click', () => {
            document.getElementById('logs-content').innerHTML = '';
        });

        // 刷新结果
        document.getElementById('refresh-results').addEventListener('click', () => {
            // 模拟刷新
            loadMockData();
            alert('结果已刷新！');
        });

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            loadMockData();
            
            // 添加平滑滚动
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
</body>
</html>