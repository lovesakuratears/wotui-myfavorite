<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘æ¨ - My Favorite</title>
    <!-- ç½‘ç«™å›¾æ ‡ - ä½¿ç”¨ICOæ–‡ä»¶ -->
    <link rel="icon" type="image/x-icon" href="/static/icons/logo.ico">
    <link rel="icon" type="image/svg+xml" href="/static/icons/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#8B5CF6'
                    }
                }
            }
        }
    </script>
    <!-- å†…è”ä»»åŠ¡åœæ­¢åŠŸèƒ½ä»£ç  -->
    <script>
        function addStopTaskButton() {
            const taskProgressDiv = document.getElementById('taskProgress');
            if (taskProgressDiv) {
                if (!document.getElementById('stopTaskBtn')) {
                    const stopBtn = document.createElement('button');
                    stopBtn.id = 'stopTaskBtn';
                    stopBtn.className = 'btn btn-danger';
                    stopBtn.textContent = 'åœæ­¢çˆ¬å–';
                    stopBtn.onclick = stopCrawlingTask;
                    stopBtn.style.marginLeft = '10px';
                    const progressBar = taskProgressDiv.querySelector('.progress');
                    if (progressBar) {
                        taskProgressDiv.insertBefore(stopBtn, progressBar.nextSibling);
                    }
                }
            }
        }
        
        function stopCrawlingTask() {
            if (!window.currentTaskId) {
                alert('æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡');
                return;
            }
            document.getElementById('stopTaskBtn').disabled = true;
            alert('æ­£åœ¨åœæ­¢ä»»åŠ¡...');
            fetch('/task/cancel', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('ä»»åŠ¡å·²åœæ­¢');
                        window.currentTaskId = null;
                    }
                });
        }
    </script>
    <!-- æ·»åŠ Font Awesomeå›¾æ ‡åº“ -->
    <!-- ç§»é™¤å¤–éƒ¨CDNä¾èµ–ï¼Œä½¿ç”¨å†…è”å›¾æ ‡ -->
    <style>
        /* ç®€å•çš„å›¾æ ‡æ›¿ä»£æ–¹æ¡ˆ */
        .icon { display: inline-block; width: 16px; height: 16px; text-align: center; line-height: 16px; }
    </style>
    <!-- ç®€å•çš„é¢å¤–æ ·å¼ -->
    <style>
        /* ç®€å•çš„å›¾æ ‡æ›¿ä»£æ ·å¼ */
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: #3B82F6;
            border-radius: 4px;
            position: relative;
        }
        .icon:before, .icon:after {
            content: '';
            position: absolute;
            background-color: white;
        }
        /* ç®€å•çš„å¤é€‰æ¡†æ›¿ä»£ */
        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #3B82F6;
            border-radius: 4px;
            display: inline-block;
            position: relative;
            cursor: pointer;
        }
        .checkbox.checked:after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #3B82F6;
            font-weight: bold;
        }
    </style>
    <!-- ç®€å•çš„Chart.jsæ›¿ä»£å®ç° -->
    <script>
        // ç®€å•çš„å›¾è¡¨æ›¿ä»£ç±»ï¼Œæ¨¡æ‹ŸChart.jsçš„åŸºæœ¬åŠŸèƒ½
        class SimpleChart {
            constructor(ctx, config) {
                this.ctx = ctx;
                this.config = config;
                this.canvas = ctx.canvas;
                this.render();
            }
            
            render() {
                const { width, height } = this.canvas;
                const data = this.config.data;
                
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.clearRect(0, 0, width, height);
                
                // ç»˜åˆ¶ç®€å•çš„æ¡å½¢å›¾æˆ–æŠ˜çº¿å›¾
                if (this.config.type === 'bar') {
                    this.renderBarChart();
                } else if (this.config.type === 'line') {
                    this.renderLineChart();
                } else {
                    // é»˜è®¤ç»˜åˆ¶ç®€å•æ–‡æœ¬
                    this.ctx.fillStyle = '#333';
                    this.ctx.font = '16px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('å›¾è¡¨æ•°æ®å¯ç”¨', width/2, height/2);
                }
            }
            
            renderBarChart() {
                const { width, height } = this.canvas;
                const data = this.config.data;
                const barWidth = width / data.labels.length * 0.7;
                const maxValue = Math.max(...data.datasets[0].data);
                
                data.labels.forEach((label, index) => {
                    const value = data.datasets[0].data[index];
                    const barHeight = (value / maxValue) * (height - 40);
                    const x = index * (width / data.labels.length) + (width / data.labels.length - barWidth) / 2;
                    const y = height - 30 - barHeight;
                    
                    // ç»˜åˆ¶æŸ±çŠ¶å›¾
                    this.ctx.fillStyle = data.datasets[0].backgroundColor || '#3B82F6';
                    this.ctx.fillRect(x, y, barWidth, barHeight);
                    
                    // ç»˜åˆ¶æ ‡ç­¾
                    this.ctx.fillStyle = '#333';
                    this.ctx.font = '12px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(label, x + barWidth/2, height - 10);
                });
            }
            
            renderLineChart() {
                const { width, height } = this.canvas;
                const data = this.config.data;
                const maxValue = Math.max(...data.datasets[0].data);
                
                // ç»˜åˆ¶æŠ˜çº¿
                this.ctx.beginPath();
                data.datasets[0].data.forEach((value, index) => {
                    const x = (index / (data.datasets[0].data.length - 1)) * (width - 40) + 20;
                    const y = height - 30 - (value / maxValue) * (height - 40);
                    
                    if (index === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                });
                this.ctx.strokeStyle = data.datasets[0].borderColor || '#3B82F6';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // ç»˜åˆ¶ç‚¹
                data.datasets[0].data.forEach((value, index) => {
                    const x = (index / (data.datasets[0].data.length - 1)) * (width - 40) + 20;
                    const y = height - 30 - (value / maxValue) * (height - 40);
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    this.ctx.fillStyle = data.datasets[0].backgroundColor || '#3B82F6';
                    this.ctx.fill();
                    
                    // ç»˜åˆ¶æ ‡ç­¾
                    if (data.labels && data.labels[index]) {
                        this.ctx.fillStyle = '#333';
                        this.ctx.font = '12px Arial';
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText(data.labels[index], x, height - 10);
                    }
                });
            }
        }
        
        // ç¡®ä¿Chartå…¨å±€å˜é‡å¯ç”¨
        window.Chart = function(ctx, config) {
            return new SimpleChart(ctx, config);
        };
    </script>
    <script>
        // Tailwind é…ç½®
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        accent: '#60A5FA',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .sidebar-shadow {
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.07);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .hover-scale {
                transition: transform 0.2s ease;
            }
            .hover-scale:hover {
                transform: scale(1.02);
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen flex flex-col transition-all duration-300">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 shadow-sm transition-all duration-300">
        <div class="flex items-center justify-between h-16 pl-4 pr-4">
            <div class="flex items-center space-x-2">
                <!-- ä½¿ç”¨æ–°çš„SVGæ–‡ä»¶ä½œä¸ºlogo -->
                <img src="/static/icons/logo.svg" alt="Logo" class="w-8 h-8 rounded-md">
                <h1 class="text-xl font-bold text-primary dark:text-secondary">æˆ‘æ¨ - My Favorite</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <span class="dark:hidden">ğŸŒ™</span>
                    <span class="hidden dark:block">â˜€ï¸</span>
                </button>
                <div class="relative">
                    <span id="status-indicator" class="inline-block w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-full"></span>
                    <span id="status-text" class="ml-2 text-sm">æœªè¿è¡Œ</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="flex pt-16 min-h-screen">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-white dark:bg-gray-800 sidebar-shadow overflow-y-auto scrollbar-hide transition-all duration-300 transform z-40">
            <nav class="py-6 px-4">
                <ul class="space-y-1">
                    <li>
                        <a href="#dashboard" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg bg-primary/10 text-primary dark:bg-primary/20 dark:text-secondary font-medium">
                            <i class="fa fa-dashboard text-lg"></i>
                            <span>ä»ªè¡¨ç›˜</span>
                        </a>
                    </li>
                    <li>
                        <a href="#config" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-cog text-lg"></i>
                            <span>é…ç½®ç®¡ç†</span>
                        </a>
                    </li>
                    <li>
                        <a href="#tasks" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-tasks text-lg"></i>
                            <span>ä»»åŠ¡æ‰§è¡Œ</span>
                        </a>
                    </li>
                    <li>
                        <a href="#results" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-folder-open text-lg"></i>
                            <span>ç»“æœç®¡ç†</span>
                        </a>
                    </li>
                    <li>
                        <a href="#logs" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-file-text text-lg"></i>
                            <span>æ—¥å¿—æŸ¥çœ‹</span>
                        </a>
                    </li>
                    <li>
                        <a href="#about" class="nav-link flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fa fa-info-circle text-lg"></i>
                            <span>å…³äº</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- å³ä¾§å†…å®¹åŒº -->
        <main class="flex-1 ml-64 transition-all duration-300 p-6">
            <!-- ä»ªè¡¨ç›˜åŒºåŸŸ -->
            <section id="dashboard" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">ä»ªè¡¨ç›˜</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-blue-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">å·²çˆ¬å–ç”¨æˆ·</p>
                                    <h3 class="text-2xl font-bold mt-1" id="user-count">0</h3>
                                </div>
                                <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-full">
                                    <i class="fa fa-users text-blue-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-green-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">å·²çˆ¬å–å¾®åš</p>
                                    <h3 class="text-2xl font-bold mt-1" id="weibo-count">0</h3>
                                </div>
                                <div class="p-3 bg-green-100 dark:bg-green-900/50 rounded-full">
                                    <i class="fa fa-comment text-green-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-purple-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">å·²ä¸‹è½½æ–‡ä»¶</p>
                                    <h3 class="text-2xl font-bold mt-1" id="file-count">0</h3>
                                </div>
                                <div class="p-3 bg-purple-100 dark:bg-purple-900/50 rounded-full">
                                    <i class="fa fa-download text-purple-500"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-orange-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm">ä»»åŠ¡æˆåŠŸç‡</p>
                                    <h3 class="text-2xl font-bold mt-1" id="success-rate">0%</h3>
                                </div>
                                <div class="p-3 bg-orange-100 dark:bg-orange-900/50 rounded-full">
                                    <i class="fa fa-line-chart text-orange-500"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">çˆ¬å–è¶‹åŠ¿</h3>
                            <div class="h-64">
                                <canvas id="crawl-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-lg">
                            <h3 class="text-lg font-semibold mb-4">æœ€è¿‘çˆ¬å–çš„ç”¨æˆ·</h3>
                            <div class="overflow-y-auto h-64 scrollbar-hide">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200 dark:border-gray-700">
                                            <th class="text-left py-2 text-sm font-medium">ç”¨æˆ·</th>
                                            <th class="text-left py-2 text-sm font-medium">å¾®åšæ•°</th>
                                            <th class="text-left py-2 text-sm font-medium">çŠ¶æ€</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-users">
                                        <tr>
                                            <td colspan="3" class="text-center py-8 text-gray-500 dark:text-gray-400">æš‚æ— æ•°æ®</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- é…ç½®ç®¡ç†åŒºåŸŸ -->
            <section id="config" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">é…ç½®ç®¡ç†</h2>
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">åŸºæœ¬é…ç½®</h3>
                            <button id="save-config" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                                <i class="fa fa-save mr-2"></i>ä¿å­˜é…ç½®
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç”¨æˆ·IDåˆ—è¡¨</label>
                                <textarea id="user-id-list" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="3" placeholder="è¯·è¾“å…¥ç”¨æˆ·IDï¼Œå¤šä¸ªIDç”¨é€—å·åˆ†éš”æˆ–æ¢è¡Œ"></textarea>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">ä¹Ÿå¯ä»¥è¾“å…¥user_id_list.txtæ–‡ä»¶è·¯å¾„</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æœç´¢å…³é”®è¯åˆ—è¡¨</label>
                                <textarea id="query-list" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="3" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼Œå¤šä¸ªå…³é”®è¯ç”¨é€—å·åˆ†éš”æˆ–æ¢è¡Œ"></textarea>
                                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">è®¾ç½®åå°†æŒ‰å…³é”®è¯æœç´¢å¾®åš</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">çˆ¬å–æ¨¡å¼</label>
                                <select id="only-crawl-original" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                                    <option value="0">çˆ¬å–å…¨éƒ¨å¾®åš</option>
                                    <option value="1">ä»…çˆ¬å–åŸåˆ›å¾®åš</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">èµ·å§‹æ—¥æœŸ</label>
                                <div class="flex space-x-2">
                                    <input type="number" id="since-date-days" class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="å¤©æ•°">
                                    <span class="flex items-center text-gray-500">å¤©å‰</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æ–‡ä»¶å­˜å‚¨ï¼ˆå¯å¤šé€‰ï¼‰</label>
                                <div class="grid grid-cols-2 gap-2 mb-4">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="write-csv" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>CSV</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="write-json" class="rounded text-primary focus:ring-primary/50">
                                        <span>JSON</span>
                                    </label>
                                </div>
                                
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æ•°æ®åº“å­˜å‚¨ï¼ˆå•é€‰ï¼‰</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="database" id="db-sqlite" class="rounded-full text-primary focus:ring-primary/50" checked>
                                        <span>SQLite</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="database" id="db-mysql" class="rounded-full text-primary focus:ring-primary/50">
                                        <span>MySQL</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="database" id="db-mongodb" class="rounded-full text-primary focus:ring-primary/50">
                                        <span>MongoDB</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">ä¸‹è½½é€‰é¡¹</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">å›¾ç‰‡ä¸‹è½½</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="original-pic" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>åŸåˆ›å¾®åšå›¾ç‰‡</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="retweet-pic" class="rounded text-primary focus:ring-primary/50">
                                        <span>è½¬å‘å¾®åšå›¾ç‰‡</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">è§†é¢‘ä¸‹è½½</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="original-video" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>åŸåˆ›å¾®åšè§†é¢‘</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="retweet-video" class="rounded text-primary focus:ring-primary/50">
                                        <span>è½¬å‘å¾®åšè§†é¢‘</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">è¯„è®ºä¸è½¬å‘</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="download-comment" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>ä¸‹è½½è¯„è®º</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="download-repost" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>ä¸‹è½½è½¬å‘</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-4">é«˜çº§é…ç½®</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cookie</label>
                                <textarea id="cookie" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" rows="2" placeholder="your cookie"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">å…¶ä»–é€‰é¡¹</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="remove-html-tag" class="rounded text-primary focus:ring-primary/50" checked>
                                        <span>ç§»é™¤HTMLæ ‡ç­¾</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="user-id-as-folder" class="rounded text-primary focus:ring-primary/50">
                                        <span>ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºæ–‡ä»¶å¤¹å</span>
                                    </label>
                                </div>
                            </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">MySQLé…ç½® <span class="text-xs text-gray-500 dark:text-gray-400">(å¯é€‰)</span></h3>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="enable-mysql" class="rounded text-primary focus:ring-primary/50">
                                <span>å¯ç”¨MySQL</span>
                            </label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ä¸»æœº</label>
                                <input type="text" id="mysql-host" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="localhost">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç«¯å£</label>
                                <input type="number" id="mysql-port" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="3306" value="3306">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç”¨æˆ·å</label>
                                <input type="text" id="mysql-user" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="root">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">å¯†ç </label>
                                <input type="password" id="mysql-password" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="password">
                            </div>
                            <div class="md:col-span-2 lg:col-span-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">å­—ç¬¦é›†</label>
                                <input type="text" id="mysql-charset" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="utf8mb4" value="utf8mb4">
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">MongoDBé…ç½® <span class="text-xs text-gray-500 dark:text-gray-400">(å¯é€‰)</span></h3>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="enable-mongodb" class="rounded text-primary focus:ring-primary/50">
                                <span>å¯ç”¨MongoDB</span>
                            </label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">MongoDB URI</label>
                            <input type="text" id="mongodb-uri" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]">
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">å®šæœŸè‡ªåŠ¨çˆ¬å–è®¾ç½® <span class="text-xs text-gray-500 dark:text-gray-400">(å¯é€‰)</span></h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">è‡ªåŠ¨çˆ¬å–é¢‘ç‡</label>
                                <div class="space-y-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="hourly" class="text-primary focus:ring-primary/50">
                                        <span>æ¯å°æ—¶</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="daily" class="text-primary focus:ring-primary/50">
                                        <span>æ¯å¤©</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="weekly" class="text-primary focus:ring-primary/50">
                                        <span>æ¯å‘¨</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="schedule-frequency" value="custom" class="text-primary focus:ring-primary/50">
                                        <span>è‡ªå®šä¹‰</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">è‡ªå®šä¹‰é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
                                <input type="number" id="custom-interval" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="60" value="60">
                                <label class="flex items-center space-x-2 mt-4">
                                    <input type="checkbox" id="enable-schedule" class="rounded text-primary focus:ring-primary/50">
                                    <span>å¯ç”¨å®šæœŸè‡ªåŠ¨çˆ¬å–</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ä»»åŠ¡æ‰§è¡ŒåŒºåŸŸ -->
            <section id="tasks" class="mb-12">
                <div id="taskProgress" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">ä»»åŠ¡æ‰§è¡Œ</h2>
                    
                    <!-- ä»»åŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                    <div class="flex items-center mb-6">
                        <span class="text-gray-700 dark:text-gray-300">ä»»åŠ¡çŠ¶æ€:</span>
                        <span id="status-indicator" class="inline-block w-3 h-3 bg-gray-300 rounded-full ml-2"></span>
                        <span id="status-text" class="ml-2 text-gray-700 dark:text-gray-300">æœªè¿è¡Œ</span>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button id="start-task" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex-1 flex items-center justify-center">
                                <div class="icon mr-2"></div>å¼€å§‹çˆ¬å–
                            </button>
                            <button id="stop-task" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex-1 flex items-center justify-center" disabled>
                                <div class="icon mr-2"></div>åœæ­¢çˆ¬å–
                            </button>
                            <button id="clear-logs" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors flex-1 flex items-center justify-center">
                                <div class="icon mr-2"></div>æ¸…ç©ºæ—¥å¿—
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">ä»»åŠ¡è¿›åº¦</h3>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-2">
                            <div id="progress-bar" class="bg-primary h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400">
                            <span id="progress-text">0%</span>
                            <span id="progress-status">å‡†å¤‡å°±ç»ª</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">ä»»åŠ¡æ—¥å¿—</h3>
                        <div id="task-log" class="w-full h-64 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 overflow-y-auto text-sm font-mono"></div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-4">è¯¦ç»†æ—¥å¿—</h3>
                        <div id="logs-content" class="w-full h-40 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 overflow-y-auto text-sm font-mono"></div>
                    </div>
                </div>
            </section>

            <!-- ç»“æœç®¡ç†åŒºåŸŸ -->
            <section id="results" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">ç»“æœç®¡ç†</h2>
                    <div class="flex justify-between items-center mb-4">
                        <div class="relative">
                            <input type="text" id="search-results" class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none" placeholder="æœç´¢ç»“æœ...">
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <button id="refresh-results" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <i class="fa fa-refresh mr-2"></i>åˆ·æ–°
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th class="text-left py-3 px-4 font-semibold">ç”¨æˆ·</th>
                                    <th class="text-left py-3 px-4 font-semibold">å¾®åšæ•°</th>
                                    <th class="text-left py-3 px-4 font-semibold">æ–‡ä»¶æ•°</th>
                                    <th class="text-left py-3 px-4 font-semibold">æœ€åæ›´æ–°</th>
                                    <th class="text-left py-3 px-4 font-semibold">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="results-table">
                                <tr>
                                    <td colspan="5" class="text-center py-8 text-gray-500 dark:text-gray-400">æš‚æ— æ•°æ®</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- æ—¥å¿—æŸ¥çœ‹åŒºåŸŸ -->
            <section id="logs" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">æ—¥å¿—æŸ¥çœ‹</h2>
                    <div class="flex justify-between items-center mb-4">
                        <select id="log-level" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none">
                            <option value="all">å…¨éƒ¨</option>
                            <option value="info">ä¿¡æ¯</option>
                            <option value="warning">è­¦å‘Š</option>
                            <option value="error">é”™è¯¯</option>
                        </select>
                        <button id="clear-logs" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <i class="fa fa-trash mr-2"></i>æ¸…ç©º
                        </button>
                    </div>
                    <div id="logs-content" class="w-full h-96 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700/50 p-4 overflow-y-auto text-sm font-mono"></div>
                </div>
            </section>

            <!-- å…³äºåŒºåŸŸ -->
            <section id="about" class="mb-12">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover-scale">
                    <h2 class="text-2xl font-bold mb-6">å…³äº</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">æˆ‘æ¨ - My Favorite</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¾®åšçˆ¬è™«å¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è½»æ¾çˆ¬å–å¾®åšç”¨æˆ·æ•°æ®ã€‚</p>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                                <li><i class="fa fa-check text-success mr-2"></i>æ”¯æŒå¤šç”¨æˆ·åŒæ—¶çˆ¬å–</li>
                                <li><i class="fa fa-check text-success mr-2"></i>æ”¯æŒå¤šç§æ•°æ®æ ¼å¼å¯¼å‡º</li>
                                <li><i class="fa fa-check text-success mr-2"></i>æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ä¸‹è½½</li>
                                <li><i class="fa fa-check text-success mr-2"></i>æ”¯æŒè¯„è®ºã€è½¬å‘çˆ¬å–</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ä½¿ç”¨è¯´æ˜</h3>
                            <ol class="list-decimal list-inside space-y-2 text-gray-600 dark:text-gray-300">
                                <li>åœ¨é…ç½®ç®¡ç†ä¸­è®¾ç½®çˆ¬å–å‚æ•°</li>
                                <li>ç‚¹å‡»ä¿å­˜é…ç½®æŒ‰é’®</li>
                                <li>åœ¨ä»»åŠ¡æ‰§è¡Œä¸­ç‚¹å‡»å¼€å§‹çˆ¬å–</li>
                                <li>æŸ¥çœ‹çˆ¬å–è¿›åº¦å’Œæ—¥å¿—</li>
                                <li>åœ¨ç»“æœç®¡ç†ä¸­æŸ¥çœ‹å’Œä¸‹è½½çˆ¬å–ç»“æœ</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- æ–‡ä»¶é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="file-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold" id="modal-title">æ–‡ä»¶é¢„è§ˆ</h3>
                <button id="close-modal" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-4 overflow-y-auto max-h-[calc(90vh-100px)]" id="modal-content">
                <!-- æ¨¡æ€æ¡†å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–ä¸»é¢˜
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // ä¸»é¢˜åˆ‡æ¢
        document.getElementById('theme-toggle').addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        });

        // å¯¼èˆªé“¾æ¥é«˜äº®
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                // ç§»é™¤æ‰€æœ‰é«˜äº®
                document.querySelectorAll('.nav-link').forEach(el => {
                    el.classList.remove('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-secondary', 'font-medium');
                    el.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                });
                // æ·»åŠ å½“å‰é«˜äº®
                this.classList.add('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-secondary', 'font-medium');
                this.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                
                // å¹³æ»‘æ»šåŠ¨åˆ°å¯¹åº”åŒºåŸŸ
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // åˆå§‹åŒ–çˆ¬å–è¶‹åŠ¿å›¾è¡¨ï¼ˆæ·»åŠ é”™è¯¯å¤„ç†ï¼‰
        if (typeof Chart !== 'undefined') {
            try {
                const ctx = document.getElementById('crawl-chart').getContext('2d');
                const crawlChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
                        datasets: [{
                            label: 'çˆ¬å–å¾®åšæ•°',
                            data: [120, 190, 300, 500, 270, 430, 360],
                            borderColor: '#1E40AF',
                            backgroundColor: 'rgba(30, 64, 175, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.warn('å›¾è¡¨åˆå§‹åŒ–å¤±è´¥:', e);
            }
        } else {
            console.warn('Chart.jsæœªåŠ è½½ï¼Œè·³è¿‡å›¾è¡¨åˆå§‹åŒ–');
        }

        // æ¨¡æ‹Ÿæ•°æ®
        function loadMockData() {
            // ä»ªè¡¨ç›˜æ•°æ®
            document.getElementById('user-count').textContent = '42';
            document.getElementById('weibo-count').textContent = '1,256';
            document.getElementById('file-count').textContent = '58';
            document.getElementById('success-rate').textContent = '98%';
            
            // æœ€è¿‘çˆ¬å–ç”¨æˆ·
            const recentUsersHtml = `
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center mr-2"><i class="fa fa-user text-blue-500"></i></div> è¿ªä¸½çƒ­å·´</div></td>
                    <td class="py-3 px-4">128</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 rounded-full text-xs">æˆåŠŸ</span></td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center mr-2"><i class="fa fa-user text-pink-500"></i></div> éƒ­ç¢§å©·</div></td>
                    <td class="py-3 px-4">85</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 rounded-full text-xs">æˆåŠŸ</span></td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center mr-2"><i class="fa fa-user text-purple-500"></i></div> æ¨å¹‚</div></td>
                    <td class="py-3 px-4">156</td>
                    <td class="py-3 px-4"><span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 rounded-full text-xs">æˆåŠŸ</span></td>
                </tr>
            `;
            document.getElementById('recent-users').innerHTML = recentUsersHtml;
            
            // ç»“æœè¡¨æ ¼æ•°æ®
            const resultsHtml = `
                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center mr-3"><i class="fa fa-user text-blue-500"></i></div> è¿ªä¸½çƒ­å·´</div></td>
                    <td class="py-3 px-4">1,245</td>
                    <td class="py-3 px-4">36</td>
                    <td class="py-3 px-4">2023-08-21 15:30</td>
                    <td class="py-3 px-4">
                        <button class="view-btn px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm mr-2" data-user="è¿ªä¸½çƒ­å·´">æŸ¥çœ‹</button>
                        <button class="download-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                    </td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center mr-3"><i class="fa fa-user text-pink-500"></i></div> éƒ­ç¢§å©·</div></td>
                    <td class="py-3 px-4">876</td>
                    <td class="py-3 px-4">24</td>
                    <td class="py-3 px-4">2023-08-21 14:15</td>
                    <td class="py-3 px-4">
                        <button class="view-btn px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm mr-2" data-user="éƒ­ç¢§å©·">æŸ¥çœ‹</button>
                        <button class="download-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                    </td>
                </tr>
                <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/30">
                    <td class="py-3 px-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center mr-3"><i class="fa fa-user text-purple-500"></i></div> æ¨å¹‚</div></td>
                    <td class="py-3 px-4">2,345</td>
                    <td class="py-3 px-4">56</td>
                    <td class="py-3 px-4">2023-08-21 12:45</td>
                    <td class="py-3 px-4">
                        <button class="view-btn px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm mr-2" data-user="æ¨å¹‚">æŸ¥çœ‹</button>
                        <button class="download-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                    </td>
                </tr>
            `;
            document.getElementById('results-table').innerHTML = resultsHtml;
            
            // é…ç½®æ•°æ®å°†é€šè¿‡loadSavedConfigå‡½æ•°ä»æœåŠ¡å™¨æˆ–æœ¬åœ°å­˜å‚¨åŠ è½½ï¼Œä¸å†ä½¿ç”¨ç¡¬ç¼–ç å€¼
            
            // åŠ è½½æ•°æ®åº“é…ç½®
            document.getElementById('mysql-host').value = 'localhost';
            document.getElementById('mysql-port').value = '3306';
            document.getElementById('mysql-user').value = 'root';
            document.getElementById('mysql-password').value = '123456';
            document.getElementById('mysql-charset').value = 'utf8mb4';
            document.getElementById('mongodb-uri').value = 'mongodb://[username:password@]host[:port][/[defaultauthdb][?options]]';
            
            // æ·»åŠ æŸ¥çœ‹æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const user = this.getAttribute('data-user');
                    showFileModal(user);
                });
            });
        }

        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆæ¨¡æ€æ¡†
        function showFileModal(user) {
            const modal = document.getElementById('file-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `${user} çš„æ–‡ä»¶åˆ—è¡¨`;
            
            // æ¨¡æ‹Ÿæ–‡ä»¶åˆ—è¡¨
            const filesHtml = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-file-text text-blue-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">${user}_data.csv</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">2.5 MB Â· CSVæ–‡ä»¶</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">é¢„è§ˆ</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-file-text text-red-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">${user}_data.json</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">3.8 MB Â· JSONæ–‡ä»¶</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">é¢„è§ˆ</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-folder text-yellow-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">images/</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">36 ä¸ªæ–‡ä»¶</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">æŸ¥çœ‹</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fa fa-folder text-green-500 text-xl mr-3"></i>
                            <div>
                                <p class="font-medium">videos/</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">12 ä¸ªæ–‡ä»¶</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">æŸ¥çœ‹</button>
                            <button class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm">ä¸‹è½½</button>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = filesHtml;
            modal.classList.remove('hidden');
        }

        // å…³é—­æ¨¡æ€æ¡†
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('file-modal').classList.add('hidden');
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('file-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('file-modal')) {
                document.getElementById('file-modal').classList.add('hidden');
            }
        });

        // æ•°æ®åº“å•é€‰æŒ‰é’®äº‹ä»¶å¤„ç†
        document.querySelectorAll('input[name="database"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // æ ¹æ®é€‰æ‹©çš„æ•°æ®åº“ç±»å‹æ›´æ–°é…ç½®æ˜¾ç¤º
                const mysqlConfig = document.querySelector('#enable-mysql').closest('.mb-8');
                const mongodbConfig = document.querySelector('#enable-mongodb').closest('.mb-8');
                
                if (this.id === 'db-mysql') {
                    mysqlConfig.style.display = 'block';
                    mongodbConfig.style.display = 'none';
                    document.getElementById('enable-mysql').checked = true;
                } else if (this.id === 'db-mongodb') {
                    mysqlConfig.style.display = 'none';
                    mongodbConfig.style.display = 'block';
                    document.getElementById('enable-mongodb').checked = true;
                } else {
                    mysqlConfig.style.display = 'none';
                    mongodbConfig.style.display = 'none';
                }
            });
        });

        // é¡µé¢åŠ è½½æ—¶éšè—æœªé€‰ä¸­çš„æ•°æ®åº“é…ç½®
        document.addEventListener('DOMContentLoaded', function() {
            const mysqlConfig = document.querySelector('#enable-mysql').closest('.mb-8');
            const mongodbConfig = document.querySelector('#enable-mongodb').closest('.mb-8');
            
            // é»˜è®¤åªæ˜¾ç¤ºSQLite
            mysqlConfig.style.display = 'none';
            mongodbConfig.style.display = 'none';
        });

        // ä¿å­˜é…ç½®åˆ°æœåŠ¡å™¨
        async function saveConfigToServer(config) {
            try {
                // éªŒè¯å¿…è¦çš„é…ç½®é¡¹
                if (!config) {
                    console.error('é…ç½®å¯¹è±¡ä¸ºç©º');
                    return { success: false, error: 'é…ç½®å¯¹è±¡ä¸ºç©º' };
                }
                
                console.log('å‡†å¤‡ä¿å­˜é…ç½®åˆ°æœåŠ¡å™¨:', config);
                
                // ä¿å­˜åŸºç¡€é…ç½®
                console.log('æ­£åœ¨ä¿å­˜åŸºç¡€é…ç½®...');
                const baseResponse = await fetch('/config/base', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id_list: config.user_id_list,
                        query_list: config.query_list,
                        only_crawl_original: config.only_crawl_original,
                        since_date: config.since_date,
                        write_mode: config.write_mode,
                        original_pic_download: config.original_pic_download,
                        retweet_pic_download: config.retweet_pic_download,
                        original_video_download: config.original_video_download,
                        retweet_video_download: config.retweet_video_download,
                        download_comment: config.download_comment,
                        download_repost: config.download_repost,
                        remove_html_tag: config.remove_html_tag,
                        user_id_as_folder_name: config.user_id_as_folder_name,
                        cookie: config.cookie
                    })
                });
                
                const baseData = await baseResponse.json();
                console.log('åŸºç¡€é…ç½®ä¿å­˜å“åº”:', baseResponse.status, baseData);
                
                if (!baseResponse.ok || !baseData.success) {
                    throw new Error(`ä¿å­˜åŸºç¡€é…ç½®å¤±è´¥: ${baseData.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
                
                // æ ¹æ®é€‰æ‹©çš„æ•°æ®åº“ç±»å‹å†³å®šæ˜¯å¦ä¿å­˜æ•°æ®åº“é…ç½®
                const selectedDb = document.querySelector('input[name="database"]:checked');
                
                // å‡†å¤‡è¦å‘é€çš„æ•°æ®åº“é…ç½®
                const dbConfig = {};
                if (selectedDb) {
                    console.log(`æ­£åœ¨ä¿å­˜${selectedDb.id === 'db-mysql' ? 'MySQL' : 'MongoDB'}æ•°æ®åº“é…ç½®...`);
                    if (selectedDb.id === 'db-mysql' && config.mysql_config) {
                        dbConfig.mysql_config = config.mysql_config;
                    } else if (selectedDb.id === 'db-mongodb' && config.mongodb_URI) {
                        dbConfig.mongodb_URI = config.mongodb_URI;
                    }
                    
                    const response = await fetch('/config/database', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dbConfig)
                    });
                    
                    const dbData = await response.json();
                    console.log('æ•°æ®åº“é…ç½®ä¿å­˜å“åº”:', response.status, dbData);
                    
                    if (!response.ok || !dbData.success) {
                        throw new Error(`ä¿å­˜æ•°æ®åº“é…ç½®å¤±è´¥: ${dbData.error || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } else {
                    console.log('æœªé€‰æ‹©æ•°æ®åº“ï¼Œè·³è¿‡æ•°æ®åº“é…ç½®ä¿å­˜');
                }
                
                // ä¿å­˜å®šæœŸçˆ¬å–é…ç½®
                console.log('æ­£åœ¨ä¿å­˜å®šæœŸçˆ¬å–é…ç½®...');
                const scheduleResponse = await fetch('/config/schedule', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config.schedule_config || { enabled: false })
                });
                
                const scheduleData = await scheduleResponse.json();
                console.log('å®šæœŸçˆ¬å–é…ç½®ä¿å­˜å“åº”:', scheduleResponse.status, scheduleData);
                
                if (!scheduleResponse.ok) {
                    throw new Error(`ä¿å­˜å®šæ—¶é…ç½®å¤±è´¥: ${scheduleData.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
                
                console.log('æ‰€æœ‰é…ç½®ä¿å­˜æˆåŠŸ');
                return { success: true, message: 'é…ç½®ä¿å­˜æˆåŠŸ' };
            } catch (error) {
                console.error('ä¿å­˜é…ç½®åˆ°æœåŠ¡å™¨å¤±è´¥:', error);
                return { success: false, error: error.message || 'ä¿å­˜å¤±è´¥' };
            }
        }
        
        // ä¿å­˜é…ç½®
        document.getElementById('save-config').addEventListener('click', async () => {
            // æ„å»ºwrite_modeæ•°ç»„
            const write_mode = [];
            
            // æ·»åŠ æ–‡ä»¶å­˜å‚¨é€‰é¡¹
            if (document.getElementById('write-csv')?.checked) write_mode.push('csv');
            if (document.getElementById('write-json')?.checked) write_mode.push('json');
            
            // æ·»åŠ æ•°æ®åº“é€‰é¡¹ï¼ˆå•é€‰ï¼‰
            const selectedDb = document.querySelector('input[name="database"]:checked');
            if (selectedDb) {
                if (selectedDb.id === 'db-sqlite') write_mode.push('sqlite');
                if (selectedDb.id === 'db-mysql') write_mode.push('mysql');
                if (selectedDb.id === 'db-mongodb') write_mode.push('mongodb');
            }
            
            // ä¿å­˜é…ç½®
            const config = {
                user_id_list: document.getElementById('user-id-list')?.value || '',
                query_list: document.getElementById('query-list')?.value || '',
                only_crawl_original: document.getElementById('only-crawl-original')?.value || '',
                since_date: document.getElementById('since-date-days')?.value || '',
                write_mode: write_mode,
                original_pic_download: document.getElementById('original-pic')?.checked ? 1 : 0,
                retweet_pic_download: document.getElementById('retweet-pic')?.checked ? 1 : 0,
                original_video_download: document.getElementById('original-video')?.checked ? 1 : 0,
                retweet_video_download: document.getElementById('retweet-video')?.checked ? 1 : 0,
                download_comment: document.getElementById('download-comment')?.checked ? 1 : 0,
                download_repost: document.getElementById('download-repost')?.checked ? 1 : 0,
                remove_html_tag: document.getElementById('remove-html-tag')?.checked ? 1 : 0,
                user_id_as_folder_name: document.getElementById('user-id-as-folder')?.checked ? 1 : 0,
                cookie: document.getElementById('cookie')?.value || '',
                
                // MySQLé…ç½®
                mysql_config: {
                    host: document.getElementById('mysql-host')?.value || '',
                    port: document.getElementById('mysql-port') ? parseInt(document.getElementById('mysql-port').value) || 3306 : 3306,
                    user: document.getElementById('mysql-user')?.value || '',
                    password: document.getElementById('mysql-password')?.value || '',
                    charset: document.getElementById('mysql-charset')?.value || 'utf8mb4'
                },
                
                // MongoDBé…ç½®
                mongodb_URI: document.getElementById('mongodb-uri')?.value || '',
                
                // å®šæœŸçˆ¬å–é…ç½®
                schedule_config: {
                    enabled: document.getElementById('enable-schedule')?.checked || false,
                    frequency: document.querySelector('input[name="schedule-frequency"]:checked')?.value || 'daily',
                    custom_interval: document.getElementById('custom-interval') ? parseInt(document.getElementById('custom-interval').value) || 60 : 60
                }
            };
            
            console.log('å‡†å¤‡ä¿å­˜çš„é…ç½®:', config);
            
            // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
            try {
                localStorage.setItem('weibo-crawler-config', JSON.stringify(config));
                console.log('é…ç½®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
            } catch (localStorageError) {
                console.error('ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', localStorageError);
            }
            
            // ä¿å­˜é…ç½®åˆ°æœåŠ¡å™¨
            const serverResult = await saveConfigToServer(config);
            
            if (serverResult.success) {
                alert('é…ç½®ä¿å­˜æˆåŠŸï¼æ‰€æœ‰è®¾ç½®å·²ä¿å­˜åˆ°æœåŠ¡å™¨å¹¶ä¼šåœ¨é‡å¯åä¿ç•™ã€‚');
            } else {
                alert(`é…ç½®ä¿å­˜å¤±è´¥ï¼é”™è¯¯ä¿¡æ¯: ${serverResult.error || 'æœªçŸ¥é”™è¯¯'}\né…ç½®å·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œä½†æœåŠ¡å™¨ä¿å­˜å¤±è´¥ã€‚`);
            }
        });
        
        // ä»æœåŠ¡å™¨åŠ è½½é…ç½®
        async function loadConfigFromServer() {
            try {
                // è·å–åŸºç¡€é…ç½®
                const baseResponse = await fetch('/config/base', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // è·å–æ•°æ®åº“é…ç½®
                const dbResponse = await fetch('/config/database', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // è·å–å®šæ—¶ä»»åŠ¡é…ç½®
                const scheduleResponse = await fetch('/config/schedule', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (baseResponse.ok && dbResponse.ok && scheduleResponse.ok) {
                    const baseConfig = await baseResponse.json();
                    const dbConfig = await dbResponse.json();
                    const scheduleConfig = await scheduleResponse.json();
                    
                    return {
                    query_list: baseConfig.query_list,
                    cookie: baseConfig.cookie,
                    user_id_list: baseConfig.user_id_list,
                    since_date: baseConfig.since_date,
                    only_crawl_original: baseConfig.only_crawl_original,
                    write_mode: baseConfig.write_mode,
                    original_pic_download: baseConfig.original_pic_download,
                    retweet_pic_download: baseConfig.retweet_pic_download,
                    original_video_download: baseConfig.original_video_download,
                    retweet_video_download: baseConfig.retweet_video_download,
                    download_comment: baseConfig.download_comment,
                    download_repost: baseConfig.download_repost,
                    remove_html_tag: baseConfig.remove_html_tag,
                    user_id_as_folder_name: baseConfig.user_id_as_folder_name,
                    mysql_config: dbConfig.mysql_config,
                    mongodb_URI: dbConfig.mongodb_URI,
                    schedule_config: scheduleConfig
                };
                }
                
                return null;
            } catch (error) {
                console.error('ä»æœåŠ¡å™¨åŠ è½½é…ç½®å¤±è´¥:', error);
                return null;
            }
        }
        
        // åŠ è½½ä¿å­˜çš„é…ç½®
        async function loadSavedConfig() {
            // å…ˆå°è¯•ä»æœåŠ¡å™¨åŠ è½½é…ç½®
            const serverConfig = await loadConfigFromServer();
            
            if (serverConfig) {
                console.log('ä»æœåŠ¡å™¨åŠ è½½çš„é…ç½®:', serverConfig);
                
                // è®¾ç½®åŸºç¡€é…ç½® - å…³é”®é¡¹ï¼šç”¨æˆ·IDåˆ—è¡¨å’Œå¤©æ•°
                const userIdListElem = document.getElementById('user-id-list');
                if (userIdListElem && serverConfig.user_id_list) {
                    // ç¡®ä¿å°†æ•°ç»„æ ¼å¼è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
                    const userIdStr = Array.isArray(serverConfig.user_id_list) 
                        ? serverConfig.user_id_list.join(', ')
                        : String(serverConfig.user_id_list);
                    userIdListElem.value = userIdStr;
                    console.log('å·²è®¾ç½®user_id_listå€¼(ä»æœåŠ¡å™¨):', userIdStr);
                }
                
                // è®¾ç½®å¤©æ•° - ä½¿ç”¨since_date
                const sinceDateElem = document.getElementById('since-date-days');
                if (sinceDateElem && serverConfig.since_date) {
                    sinceDateElem.value = serverConfig.since_date;
                    console.log('å·²è®¾ç½®since_dateå€¼(ä»æœåŠ¡å™¨):', serverConfig.since_date);
                }
                
                // è®¾ç½®MySQLé…ç½®
                if (serverConfig.mysql_config) {
                    if (serverConfig.mysql_config.host) document.getElementById('mysql-host').value = serverConfig.mysql_config.host;
                    if (serverConfig.mysql_config.port) document.getElementById('mysql-port').value = serverConfig.mysql_config.port;
                    if (serverConfig.mysql_config.user) document.getElementById('mysql-user').value = serverConfig.mysql_config.user;
                    if (serverConfig.mysql_config.password) document.getElementById('mysql-password').value = serverConfig.mysql_config.password;
                    if (serverConfig.mysql_config.charset) document.getElementById('mysql-charset').value = serverConfig.mysql_config.charset;
                }
                
                // è®¾ç½®MongoDBé…ç½®
                if (serverConfig.mongodb_URI) document.getElementById('mongodb-uri').value = serverConfig.mongodb_URI;
                
                // è®¾ç½®å…¶ä»–åŸºç¡€é…ç½®
                if (serverConfig.query_list) document.getElementById('query-list').value = serverConfig.query_list;
                if (serverConfig.cookie) document.getElementById('cookie').value = serverConfig.cookie;
                if (serverConfig.only_crawl_original !== undefined) document.getElementById('only-crawl-original').value = serverConfig.only_crawl_original;
                
                // è®¾ç½®å†™å…¥æ¨¡å¼
                if (serverConfig.write_mode) {
                    document.getElementById('write-csv').checked = serverConfig.write_mode.includes('csv');
                    document.getElementById('write-json').checked = serverConfig.write_mode.includes('json');
                    // æ•°æ®åº“é€‰é¡¹
                    if (serverConfig.write_mode.includes('sqlite')) {
                        document.getElementById('db-sqlite').checked = true;
                    }
                    if (serverConfig.write_mode.includes('mysql')) {
                        document.getElementById('db-mysql').checked = true;
                    }
                    if (serverConfig.write_mode.includes('mongodb')) {
                        document.getElementById('db-mongodb').checked = true;
                    }
                }
                
                // è®¾ç½®ä¸‹è½½é€‰é¡¹
                if (serverConfig.original_pic_download !== undefined) document.getElementById('original-pic').checked = serverConfig.original_pic_download;
                if (serverConfig.retweet_pic_download !== undefined) document.getElementById('retweet-pic').checked = serverConfig.retweet_pic_download;
                if (serverConfig.original_video_download !== undefined) document.getElementById('original-video').checked = serverConfig.original_video_download;
                if (serverConfig.retweet_video_download !== undefined) document.getElementById('retweet-video').checked = serverConfig.retweet_video_download;
                if (serverConfig.download_comment !== undefined) document.getElementById('download-comment').checked = serverConfig.download_comment;
                if (serverConfig.download_repost !== undefined) document.getElementById('download-repost').checked = serverConfig.download_repost;
                
                // è®¾ç½®å®šæœŸçˆ¬å–é…ç½®
                if (serverConfig.schedule_config) {
                    if (serverConfig.schedule_config.enabled !== undefined) document.getElementById('enable-schedule').checked = serverConfig.schedule_config.enabled;
                    if (serverConfig.schedule_config.interval) {
                        const freqInput = document.querySelector(`input[name="schedule-frequency"][value="${serverConfig.schedule_config.interval}"]`);
                        if (freqInput) freqInput.checked = true;
                    }
                    if (serverConfig.schedule_config.custom_interval) document.getElementById('custom-interval').value = serverConfig.schedule_config.custom_interval;
                }
                
                console.log('å·²ä»æœåŠ¡å™¨åŠ è½½é…ç½®');
            } else {
                // å¦‚æœæœåŠ¡å™¨åŠ è½½å¤±è´¥ï¼Œå°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                const savedConfig = localStorage.getItem('weibo-crawler-config');
                if (savedConfig) {
                    try {
                        const config = JSON.parse(savedConfig);
                        
                        // è®¾ç½®åŸºæœ¬é…ç½®
                        const userIdListElem = document.getElementById('user-id-list');
                        if (userIdListElem && config.user_id_list) {
                            // ç¡®ä¿å°†æ•°ç»„æ ¼å¼è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
                            const userIdStr = Array.isArray(config.user_id_list) 
                                ? config.user_id_list.join(', ') 
                                : String(config.user_id_list);
                            userIdListElem.value = userIdStr;
                            console.log('å·²è®¾ç½®user_id_listå€¼:', userIdStr);
                        }
                        
                        const queryListElem = document.getElementById('query-list');
                        if (queryListElem && config.query_list) queryListElem.value = config.query_list;
                        
                        const onlyCrawlOriginalElem = document.getElementById('only-crawl-original');
                        if (onlyCrawlOriginalElem && config.only_crawl_original !== undefined) onlyCrawlOriginalElem.value = config.only_crawl_original;
                        
                        const sinceDateElem = document.getElementById('since-date-days');
                        if (sinceDateElem && config.since_date) {
                            sinceDateElem.value = config.since_date;
                            console.log('å·²è®¾ç½®since_dateå€¼:', config.since_date);
                        }
                        
                        const cookieElem = document.getElementById('cookie');
                        if (cookieElem && config.cookie) cookieElem.value = config.cookie;
                        
                        // è®¾ç½®å†™å…¥æ¨¡å¼
                        if (config.write_mode) {
                            const writeCsvElem = document.getElementById('write-csv');
                            if (writeCsvElem) writeCsvElem.checked = config.write_mode.includes('csv');
                            
                            const writeJsonElem = document.getElementById('write-json');
                            if (writeJsonElem) writeJsonElem.checked = config.write_mode.includes('json');
                            
                            const writeSqliteElem = document.getElementById('write-sqlite');
                            if (writeSqliteElem) writeSqliteElem.checked = config.write_mode.includes('sqlite');
                            
                            const writeMySqlElem = document.getElementById('write-mysql');
                            if (writeMySqlElem) writeMySqlElem.checked = config.write_mode.includes('mysql');
                        }
                        
                        // è®¾ç½®ä¸‹è½½é€‰é¡¹
                        const originalPicElem = document.getElementById('original-pic');
                        if (originalPicElem && config.original_pic_download !== undefined) originalPicElem.checked = config.original_pic_download === 1;
                        
                        const retweetPicElem = document.getElementById('retweet-pic');
                        if (retweetPicElem && config.retweet_pic_download !== undefined) retweetPicElem.checked = config.retweet_pic_download === 1;
                        
                        const originalVideoElem = document.getElementById('original-video');
                        if (originalVideoElem && config.original_video_download !== undefined) originalVideoElem.checked = config.original_video_download === 1;
                        
                        const retweetVideoElem = document.getElementById('retweet-video');
                        if (retweetVideoElem && config.retweet_video_download !== undefined) retweetVideoElem.checked = config.retweet_video_download === 1;
                        
                        const downloadCommentElem = document.getElementById('download-comment');
                        if (downloadCommentElem && config.download_comment !== undefined) downloadCommentElem.checked = config.download_comment === 1;
                        
                        const downloadRepostElem = document.getElementById('download-repost');
                        if (downloadRepostElem && config.download_repost !== undefined) downloadRepostElem.checked = config.download_repost === 1;
                        
                        // è®¾ç½®å…¶ä»–é€‰é¡¹
                        const removeHtmlTagElem = document.getElementById('remove-html-tag');
                        if (removeHtmlTagElem && config.remove_html_tag !== undefined) removeHtmlTagElem.checked = config.remove_html_tag === 1;
                        
                        const userIdAsFolderElem = document.getElementById('user-id-as-folder');
                        if (userIdAsFolderElem && config.user_id_as_folder_name !== undefined) userIdAsFolderElem.checked = config.user_id_as_folder_name === 1;
                        
                        // è®¾ç½®MySQLé…ç½®
                        if (config.mysql_config) {
                            const mysqlHostElem = document.getElementById('mysql-host');
                            if (mysqlHostElem && config.mysql_config.host) mysqlHostElem.value = config.mysql_config.host;
                            
                            const mysqlPortElem = document.getElementById('mysql-port');
                            if (mysqlPortElem && config.mysql_config.port) mysqlPortElem.value = config.mysql_config.port;
                            
                            const mysqlUserElem = document.getElementById('mysql-user');
                            if (mysqlUserElem && config.mysql_config.user) mysqlUserElem.value = config.mysql_config.user;
                            
                            const mysqlPasswordElem = document.getElementById('mysql-password');
                            if (mysqlPasswordElem && config.mysql_config.password) mysqlPasswordElem.value = config.mysql_config.password;
                            
                            const mysqlCharsetElem = document.getElementById('mysql-charset');
                            if (mysqlCharsetElem && config.mysql_config.charset) mysqlCharsetElem.value = config.mysql_config.charset;
                        }
                        
                        // è®¾ç½®MongoDBé…ç½®
                        const mongodbUriElem = document.getElementById('mongodb-uri');
                        if (mongodbUriElem && config.mongodb_URI) mongodbUriElem.value = config.mongodb_URI;
                        
                        // è®¾ç½®å®šæœŸçˆ¬å–é…ç½®
                        if (config.schedule_config) {
                            const enableScheduleElem = document.getElementById('enable-schedule');
                            if (enableScheduleElem && config.schedule_config.enabled !== undefined) enableScheduleElem.checked = config.schedule_config.enabled;
                            
                            if (config.schedule_config.frequency) {
                                try {
                                    const freqInput = document.querySelector(`input[name="schedule-frequency"][value="${config.schedule_config.frequency}"]`);
                                    if (freqInput) freqInput.checked = true;
                                } catch (err) {
                                    console.error('è®¾ç½®çˆ¬å–é¢‘ç‡æ—¶å‡ºé”™:', err);
                                }
                            }
                            
                            const customIntervalElem = document.getElementById('custom-interval');
                            if (customIntervalElem && config.schedule_config.custom_interval) customIntervalElem.value = config.schedule_config.custom_interval;
                        }
                        
                        console.log('å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½é…ç½®');
                    } catch (e) {
                        console.error('åŠ è½½ä¿å­˜çš„é…ç½®å¤±è´¥:', e);
                    }
                }
            }
        }
        
        // åˆå§‹åŒ–æ—¶åŠ è½½ä¿å­˜çš„é…ç½®
        (async function() {
            await loadSavedConfig();
        })();
        
        // è¯»å–é…ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            // åˆ›å»ºè¯»å–é…ç½®æŒ‰é’®
            const configSection = document.querySelector('#config');
            if (configSection) {
                const sectionHeader = configSection.querySelector('h2');
                if (sectionHeader) {
                    const readConfigBtn = document.createElement('button');
                    readConfigBtn.id = 'read-config';
                    readConfigBtn.className = 'ml-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors';
                    readConfigBtn.textContent = 'è¯»å–é…ç½®';
                    readConfigBtn.onclick = async () => {
                        addLog('[INFO] æ­£åœ¨è¯»å–é…ç½®...', 'info');
                        await loadSavedConfig();
                        addLog('[INFO] é…ç½®è¯»å–å®Œæˆ', 'info');
                    };
                    sectionHeader.parentNode.insertBefore(readConfigBtn, sectionHeader.nextSibling);
                }
            }
        });

        // å¼€å§‹çˆ¬å–ä»»åŠ¡
        document.getElementById('start-task').addEventListener('click', async () => {
            const startBtn = document.getElementById('start-task');
            const stopBtn = document.getElementById('stop-task');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressStatus = document.getElementById('progress-status');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const taskLog = document.getElementById('task-log');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full animate-pulse';
            statusText.textContent = 'è¿è¡Œä¸­';
            
            // é‡ç½®è¿›åº¦å’Œæ—¥å¿—
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            progressStatus.textContent = 'å¼€å§‹çˆ¬å–...';
            taskLog.innerHTML = '';
            
            // æ·»åŠ å¼€å§‹æ—¥å¿—
            addLog('[INFO] å¼€å§‹çˆ¬å–å¾®åšæ•°æ®...', 'info');
            
            try {
                // è°ƒç”¨åç«¯APIå¼€å§‹ä»»åŠ¡
                const response = await fetch('/refresh', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                
                if (!response.ok) {
                    throw new Error(`APIå“åº”é”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                const taskId = data.task_id;
                // ä¿å­˜ä»»åŠ¡IDåˆ°localStorageï¼Œç”¨äºé¡µé¢åˆ·æ–°åæ¢å¤çŠ¶æ€
                localStorage.setItem('lastTaskId', taskId);
                addLog(`[INFO] ä»»åŠ¡å·²åˆ›å»ºï¼ŒID: ${taskId}`, 'info');
                
                // è½®è¯¢ä»»åŠ¡çŠ¶æ€
                const checkStatus = async () => {
                    try {
                        // æ·»åŠ è¶…æ—¶çš„fetchè¯·æ±‚
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5ç§’è¶…æ—¶
                        
                        const statusResponse = await fetch(`/task/${taskId}`, {
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                        
                        if (!statusResponse.ok) {
                            throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${statusResponse.status}`);
                        }
                        
                        const taskStatus = await statusResponse.json();
                        
                        // æ›´æ–°è¿›åº¦
                        if (taskStatus.progress !== undefined) {
                            progressBar.style.width = `${taskStatus.progress}%`;
                            progressText.textContent = `${taskStatus.progress}%`;
                        }
                        
                        // æ›´æ–°çŠ¶æ€æ–‡æœ¬
                        if (taskStatus.state === 'PROGRESS') {
                            if (taskStatus.progress < 50) {
                                progressStatus.textContent = 'æ­£åœ¨çˆ¬å–æ•°æ®...';
                            } else {
                                progressStatus.textContent = 'æ­£åœ¨å¤„ç†ç»“æœ...';
                            }
                        } else if (taskStatus.state === 'SUCCESS' || taskStatus.state === 'COMPLETED') {
                            progressStatus.textContent = 'ä»»åŠ¡å®Œæˆ';
                            progressBar.style.width = '100%';
                            progressText.textContent = '100%';
                            addLog('[INFO] æ‰€æœ‰ç”¨æˆ·çˆ¬å–å®Œæˆ', 'info');
                            addLog('[INFO] ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ', 'info');
                            
                            // æ›´æ–°æŒ‰é’®çŠ¶æ€
                            startBtn.disabled = false;
                            stopBtn.disabled = true;
                            statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full';
                            statusText.textContent = 'å·²å®Œæˆ';
                            return;
                        } else if (taskStatus.state === 'FAILED') {
                            progressStatus.textContent = 'ä»»åŠ¡å¤±è´¥';
                            addLog(`[ERROR] ä»»åŠ¡æ‰§è¡Œå¤±è´¥: ${taskStatus.error}`, 'error');
                            
                            // æ›´æ–°æŒ‰é’®çŠ¶æ€
                            startBtn.disabled = false;
                            stopBtn.disabled = true;
                            statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                            statusText.textContent = 'å·²å¤±è´¥';
                            return;
                        }
                        
                        // ç»§ç»­è½®è¯¢
                        setTimeout(checkStatus, 1000);
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            addLog('[ERROR] è·å–ä»»åŠ¡çŠ¶æ€è¶…æ—¶ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ', 'error');
                        } else {
                            addLog(`[ERROR] è·å–ä»»åŠ¡çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
                        }
                        startBtn.disabled = false;
                        stopBtn.disabled = true;
                        statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                        statusText.textContent = 'å·²å¤±è´¥';
                    }
                };
                
                // å¼€å§‹è½®è¯¢
                setTimeout(checkStatus, 1000);
                
            } catch (error) {
                addLog(`[ERROR] åˆ›å»ºä»»åŠ¡å¤±è´¥: ${error.message}`, 'error');
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                statusText.textContent = 'å·²å¤±è´¥';
            }
        });
        
        // æ·»åŠ æ—¥å¿—è¾…åŠ©å‡½æ•°
        function addLog(message, level = 'info') {
            // æ·»åŠ æ—¶é—´æˆ³
            const now = new Date();
            const timestamp = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const logText = `[${timestamp}] ${message}`;
            
            const taskLog = document.getElementById('task-log');
            const logItem = document.createElement('div');
            logItem.textContent = logText;
            
            // æ ¹æ®æ—¥å¿—çº§åˆ«è®¾ç½®é¢œè‰²
            if (level === 'info') {
                logItem.className = 'text-green-600 dark:text-green-400';
            } else if (level === 'warning') {
                logItem.className = 'text-yellow-600 dark:text-yellow-400';
            } else if (level === 'error') {
                logItem.className = 'text-red-600 dark:text-red-400';
            }
            
            taskLog.appendChild(logItem);
            taskLog.scrollTop = taskLog.scrollHeight;
            
            // åŒæ—¶æ›´æ–°logs-contentåŒºåŸŸ
            const logsContent = document.getElementById('logs-content');
            if (logsContent) {
                const logItemClone = logItem.cloneNode(true);
                logsContent.appendChild(logItemClone);
                logsContent.scrollTop = logsContent.scrollHeight;
            }
        }

        // åœæ­¢çˆ¬å–ä»»åŠ¡
        document.getElementById('stop-task').addEventListener('click', async () => {
            const startBtn = document.getElementById('start-task');
            const stopBtn = document.getElementById('stop-task');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const progressStatus = document.getElementById('progress-status');
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            try {
                // è°ƒç”¨åç«¯APIåœæ­¢ä»»åŠ¡
                const response = await fetch('/task/cancel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    addLog('[INFO] ä»»åŠ¡å·²æˆåŠŸåœæ­¢', 'info');
                } else {
                    addLog('[WARNING] åœæ­¢ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯', 'warning');
                }
            } catch (error) {
                addLog(`[ERROR] åœæ­¢ä»»åŠ¡å¤±è´¥: ${error.message}`, 'error');
            }
            
            // æ›´æ–°çŠ¶æ€
            statusIndicator.className = 'inline-block w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-full';
            statusText.textContent = 'å·²åœæ­¢';
            progressStatus.textContent = 'ä»»åŠ¡å·²åœæ­¢';
            
            // æ—¥å¿—å·²é€šè¿‡addLogå‡½æ•°æ·»åŠ ï¼Œæ— éœ€é‡å¤æ·»åŠ 
        });

        // æ¸…ç©ºæ—¥å¿—
        document.getElementById('clear-logs').addEventListener('click', () => {
            document.getElementById('logs-content').innerHTML = '';
        });

        // åˆ·æ–°ç»“æœ
        document.getElementById('refresh-results').addEventListener('click', () => {
            // æ¨¡æ‹Ÿåˆ·æ–°
            loadMockData();
            alert('ç»“æœå·²åˆ·æ–°ï¼');
        });

        // æ¢å¤ä»»åŠ¡çŠ¶æ€å‡½æ•°
        async function restoreTaskState() {
            try {
                // é¦–å…ˆæ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡
                const currentTaskResponse = await fetch('/task/current');
                if (currentTaskResponse.ok) {
                    const currentTaskData = await currentTaskResponse.json();
                    
                    // å¦‚æœæœ‰è¿è¡Œä¸­çš„ä»»åŠ¡
                    if (currentTaskData.task_id && currentTaskData.state === 'PROGRESS') {
                        const taskId = currentTaskData.task_id;
                        localStorage.setItem('lastTaskId', taskId); // æ›´æ–°localStorageä¸­çš„taskId
                        addLog(`[INFO] å‘ç°æœåŠ¡ç«¯æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œä»»åŠ¡ID: ${taskId}`, 'info');
                        
                        // åˆå§‹åŒ–è½®è¯¢æ›´æ–°ä»»åŠ¡çŠ¶æ€
                        initializeTaskMonitoring(taskId, currentTaskData);
                        return;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œå°è¯•ä»localStorageæ¢å¤æœ€è¿‘çš„ä»»åŠ¡çŠ¶æ€
                const taskId = localStorage.getItem('lastTaskId');
                if (taskId) {
                    addLog(`[INFO] æ­£åœ¨ä»æœ¬åœ°å­˜å‚¨æ¢å¤ä»»åŠ¡çŠ¶æ€ï¼Œä»»åŠ¡ID: ${taskId}`, 'info');
                    
                    // è·å–ä»»åŠ¡çŠ¶æ€
                    const response = await fetch(`/task/${taskId}`);
                    if (response.ok) {
                        const taskStatus = await response.json();
                        
                        // æ›´æ–°UIçŠ¶æ€
                        updateUIWithTaskStatus(taskId, taskStatus);
                    } else {
                        addLog('[WARNING] æ— æ³•è·å–ä»»åŠ¡çŠ¶æ€ï¼Œå¯èƒ½å·²è¿‡æœŸ', 'warning');
                        localStorage.removeItem('lastTaskId');
                    }
                }
            } catch (error) {
                console.error('æ¢å¤ä»»åŠ¡çŠ¶æ€å¤±è´¥:', error);
                addLog(`[ERROR] æ¢å¤ä»»åŠ¡çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // åˆå§‹åŒ–ä»»åŠ¡ç›‘æ§
        function initializeTaskMonitoring(taskId, initialStatus) {
            // æ›´æ–°UIçŠ¶æ€
            updateUIWithTaskStatus(taskId, initialStatus);
            
            // å¦‚æœä»»åŠ¡ä»åœ¨è¿›è¡Œä¸­ï¼Œå¼€å§‹è½®è¯¢
            if (initialStatus.state === 'PROGRESS') {
                const checkStatus = async () => {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        const statusResponse = await fetch(`/task/${taskId}`, {
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                        
                        if (statusResponse.ok) {
                            const currentStatus = await statusResponse.json();
                            
                            // æ›´æ–°è¿›åº¦
                            const progressBar = document.getElementById('progress-bar');
                            const progressText = document.getElementById('progress-text');
                            const progressStatus = document.getElementById('progress-status');
                            
                            if (currentStatus.progress !== undefined) {
                                progressBar.style.width = `${currentStatus.progress}%`;
                                progressText.textContent = `${currentStatus.progress}%`;
                            }
                            
                            // å¤„ç†å®æ—¶æ—¥å¿—æ›´æ–°
                            if (currentStatus.logs && Array.isArray(currentStatus.logs)) {
                                // è·å–å½“å‰å·²æ˜¾ç¤ºçš„æ—¥å¿—è¡Œæ•°
                                const taskLog = document.getElementById('task-log');
                                const currentLogCount = taskLog.children.length;
                                
                                // åªæ·»åŠ æ–°çš„æ—¥å¿—
                                if (currentStatus.logs.length > currentLogCount) {
                                    const newLogs = currentStatus.logs.slice(currentLogCount);
                                    newLogs.forEach(log => {
                                        // æ ¼å¼åŒ–æ—¶é—´æˆ³
                                        const date = new Date(log.timestamp);
                                        const formattedTime = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
                                        addLog(`[${formattedTime}] ${log.message}`, log.level);
                                    });
                                }
                            }
                            
                            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
                            if (currentStatus.state === 'PROGRESS') {
                                if (currentStatus.progress < 50) {
                                    progressStatus.textContent = 'æ­£åœ¨çˆ¬å–æ•°æ®...';
                                } else {
                                    progressStatus.textContent = 'æ­£åœ¨å¤„ç†ç»“æœ...';
                                }
                                setTimeout(checkStatus, 1000);
                            } else if (currentStatus.state === 'SUCCESS' || currentStatus.state === 'COMPLETED') {
                                progressStatus.textContent = 'ä»»åŠ¡å®Œæˆ';
                                progressBar.style.width = '100%';
                                progressText.textContent = '100%';
                                addLog('[INFO] æ‰€æœ‰ç”¨æˆ·çˆ¬å–å®Œæˆ', 'info');
                                addLog('[INFO] ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ', 'info');
                                
                                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                                const startBtn = document.getElementById('start-task');
                                const stopBtn = document.getElementById('stop-task');
                                const statusIndicator = document.getElementById('status-indicator');
                                const statusText = document.getElementById('status-text');
                                
                                startBtn.disabled = false;
                                stopBtn.disabled = true;
                                statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full';
                                statusText.textContent = 'å·²å®Œæˆ';
                            } else if (currentStatus.state === 'FAILED') {
                                progressStatus.textContent = 'ä»»åŠ¡å¤±è´¥';
                                addLog(`[ERROR] ä»»åŠ¡æ‰§è¡Œå¤±è´¥: ${currentStatus.error}`, 'error');
                                
                                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                                const startBtn = document.getElementById('start-task');
                                const stopBtn = document.getElementById('stop-task');
                                const statusIndicator = document.getElementById('status-indicator');
                                const statusText = document.getElementById('status-text');
                                
                                startBtn.disabled = false;
                                stopBtn.disabled = true;
                                statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                                statusText.textContent = 'å·²å¤±è´¥';
                            } else if (currentStatus.state === 'CANCELLED') {
                                progressStatus.textContent = 'ä»»åŠ¡å·²å–æ¶ˆ';
                                addLog('[INFO] ä»»åŠ¡å·²è¢«å–æ¶ˆ', 'info');
                                
                                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                                const startBtn = document.getElementById('start-task');
                                const stopBtn = document.getElementById('stop-task');
                                const statusIndicator = document.getElementById('status-indicator');
                                const statusText = document.getElementById('status-text');
                                
                                startBtn.disabled = false;
                                stopBtn.disabled = true;
                                statusIndicator.className = 'inline-block w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-full';
                                statusText.textContent = 'å·²å–æ¶ˆ';
                            }
                        }
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            addLog('[ERROR] è·å–ä»»åŠ¡çŠ¶æ€è¶…æ—¶ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ', 'error');
                        } else {
                            addLog(`[ERROR] è·å–ä»»åŠ¡çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
                        }
                    }
                };
                
                setTimeout(checkStatus, 1000);
            }
        }
        
        // æ›´æ–°UIæ˜¾ç¤ºä»»åŠ¡çŠ¶æ€
        function updateUIWithTaskStatus(taskId, taskStatus) {
            // æ›´æ–°UIçŠ¶æ€
            const startBtn = document.getElementById('start-task');
            const stopBtn = document.getElementById('stop-task');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressStatus = document.getElementById('progress-status');
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            // æ›´æ–°è¿›åº¦
            if (taskStatus.progress !== undefined) {
                progressBar.style.width = `${taskStatus.progress}%`;
                progressText.textContent = `${taskStatus.progress}%`;
                addLog(`[INFO] ä»»åŠ¡çŠ¶æ€æ¢å¤æˆåŠŸï¼Œå½“å‰è¿›åº¦: ${taskStatus.progress}%`, 'info');
            }
            
            // æ›´æ–°çŠ¶æ€å’ŒæŒ‰é’®
            if (taskStatus.state === 'PROGRESS') {
                // ä»»åŠ¡ä»åœ¨è¿›è¡Œä¸­
                startBtn.disabled = true;
                stopBtn.disabled = false;
                statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full animate-pulse';
                statusText.textContent = 'è¿è¡Œä¸­';
                
                if (taskStatus.progress < 50) {
                    progressStatus.textContent = 'æ­£åœ¨çˆ¬å–æ•°æ®...';
                } else {
                    progressStatus.textContent = 'æ­£åœ¨å¤„ç†ç»“æœ...';
                }
            } else if (taskStatus.state === 'SUCCESS' || taskStatus.state === 'COMPLETED') {
                // ä»»åŠ¡å·²å®Œæˆ
                progressStatus.textContent = 'ä»»åŠ¡å®Œæˆ';
                progressBar.style.width = '100%';
                progressText.textContent = '100%';
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusIndicator.className = 'inline-block w-3 h-3 bg-success rounded-full';
                statusText.textContent = 'å·²å®Œæˆ';
                
                addLog('[INFO] å‘ç°å·²å®Œæˆçš„ä»»åŠ¡', 'info');
            } else if (taskStatus.state === 'FAILED') {
                // ä»»åŠ¡å·²å¤±è´¥
                progressStatus.textContent = 'ä»»åŠ¡å¤±è´¥';
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusIndicator.className = 'inline-block w-3 h-3 bg-error rounded-full';
                statusText.textContent = 'å·²å¤±è´¥';
                
                addLog(`[INFO] å‘ç°å¤±è´¥çš„ä»»åŠ¡: ${taskStatus.error || ''}`, 'info');
            } else if (taskStatus.state === 'CANCELLED') {
                // ä»»åŠ¡å·²å–æ¶ˆ
                progressStatus.textContent = 'ä»»åŠ¡å·²å–æ¶ˆ';
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusIndicator.className = 'inline-block w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-full';
                statusText.textContent = 'å·²å–æ¶ˆ';
                
                addLog('[INFO] å‘ç°å·²å–æ¶ˆçš„ä»»åŠ¡', 'info');
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            // ç¡®ä¿DOMåŠ è½½å®Œæˆåè¯»å–é…ç½®
            loadSavedConfig();
            loadMockData();
            
            // å°è¯•æ¢å¤ä»»åŠ¡çŠ¶æ€
            restoreTaskState();
            
            // æ¸…ç©ºæ—¥å¿—æŒ‰é’®åŠŸèƒ½
            if (document.getElementById('clear-logs')) {
                document.getElementById('clear-logs').addEventListener('click', function() {
                    const taskLog = document.getElementById('task-log');
                    const logsContent = document.getElementById('logs-content');
                    if (taskLog) taskLog.innerHTML = '';
                    if (logsContent) logsContent.innerHTML = '';
                    addLog('æ—¥å¿—å·²æ¸…ç©º');
                });
            }
            
            // æ·»åŠ å¹³æ»‘æ»šåŠ¨
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
</body>
</html>